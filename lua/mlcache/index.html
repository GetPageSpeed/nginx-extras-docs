
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Automatic documentation from sources, for NGINX Extras.">
      
      
        <meta name="author" content="Danila Vershinin">
      
      
        <link rel="canonical" href="https://nginx-extras.getpagespeed.com/lua/mlcache/">
      
      
        <link rel="prev" href="../memcached/">
      
      
        <link rel="next" href="../multiplexer/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>mlcache - NGINX Extras Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-YZHLYCQK9D"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-YZHLYCQK9D",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-YZHLYCQK9D",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="mlcache - NGINX Extras Documentation" >
      
        <meta  property="og:description"  content="Automatic documentation from sources, for NGINX Extras." >
      
        <meta  property="og:image"  content="https://nginx-extras.getpagespeed.com/assets/images/social/lua/mlcache.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://nginx-extras.getpagespeed.com/lua/mlcache/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="mlcache - NGINX Extras Documentation" >
      
        <meta  name="twitter:description"  content="Automatic documentation from sources, for NGINX Extras." >
      
        <meta  name="twitter:image"  content="https://nginx-extras.getpagespeed.com/assets/images/social/lua/mlcache.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="getpagespeed" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mlcache-layered-caching-library-for-nginx-module-lua" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
  NGINX Extras is <a href="https://www.getpagespeed.com/repo-subscribe" target="_blank"><em>subscription-ware</em></a> by GetPageSpeed, allowing your server to be secure and fast.

          </div>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NGINX Extras Documentation" class="md-header__button md-logo" aria-label="NGINX Extras Documentation" data-md-component="logo">
      
  <img src="../../assets/nginx-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NGINX Extras Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              mlcache
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="getpagespeed" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../modules/" class="md-tabs__link">
          
  
  Modules

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Lua Scripting

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../branches/" class="md-tabs__link">
          
  
  Distributions

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://www.getpagespeed.com/redhat" class="md-tabs__link">
        
  
    
  
  RPM Repository

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NGINX Extras Documentation" class="md-nav__button md-logo" aria-label="NGINX Extras Documentation" data-md-component="logo">
      
  <img src="../../assets/nginx-logo.png" alt="logo">

    </a>
    NGINX Extras Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/accept-language/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    accept-language
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ajp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ajp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/array-var/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    array-var
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/auth-digest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auth-digest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/auth-ldap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auth-ldap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/auth-pam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auth-pam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/auth-totp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auth-totp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/aws-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/bot-verifier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bot-verifier
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/brotli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    brotli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/cache-purge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cache-purge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/captcha/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    captcha
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/combined-upstreams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    combined-upstreams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/concat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    concat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/cookie-flag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cookie-flag
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/cookie-limit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cookie-limit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/coolkit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    coolkit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/dav-ext/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dav-ext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/doh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    doh
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/dynamic-etag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dynamic-etag
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/dynamic-limit-req/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dynamic-limit-req
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/echo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    echo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/encrypted-session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    encrypted-session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/execute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    execute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/f4fhds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    f4fhds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/fancyindex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fancyindex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/fips-check/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fips-check
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/flv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/form-input/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    form-input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/geoip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    geoip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/geoip2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    geoip2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/google/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    google
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/graphite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    graphite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/headers-more/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    headers-more
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/hmac-secure-link/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hmac-secure-link
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/html-sanitize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    html-sanitize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/iconv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iconv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/image-filter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    image-filter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/immutable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    immutable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ipscrub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ipscrub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/jpeg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jpeg
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/js-challenge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    js-challenge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/json/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    json
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/json-var/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    json-var
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/jwt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jwt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/length-hiding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    length-hiding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/let/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    let
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/live-common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    live-common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/log-zmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    log-zmq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/lua/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lua
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/markdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    markdown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/memc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    memc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/naxsi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    naxsi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/nchan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nchan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ndk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ndk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/njs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    njs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ntlm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ntlm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/pagespeed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pagespeed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/passenger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    passenger
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/perl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    perl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/phantom-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    phantom-token
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/postgres/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postgres
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/pta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/push-stream/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    push-stream
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/rdns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rdns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/redis2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/rtmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rtmp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/secure-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    secure-token
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/security-headers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    security-headers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/set-misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    set-misc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/shibboleth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shibboleth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/slowfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    slowfs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/small-light/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    small-light
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/spnego-http-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    spnego-http-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/srcache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    srcache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/srt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    srt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/statsd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    statsd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sticky/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sticky
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/stream-lua/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stream-lua
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/stream-sts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stream-sts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/stream-upsync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stream-upsync
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/substitutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    substitutions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sysguard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sysguard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/testcookie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    testcookie
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/traffic-accounting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    traffic-accounting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/untar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    untar
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/upload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upload
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/upstream-fair/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upstream-fair
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/upstream-jdomain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upstream-jdomain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/upsync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upsync
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/vod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vod
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/vts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/webp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    webp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/xslt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xslt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/xss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/zip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/zstd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zstd
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Lua Scripting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Lua Scripting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../acme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    acme
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ada/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ada
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auto-ssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auto-ssl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws-sdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws-sdk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../balancer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    balancer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base-encoding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base-encoding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../checkups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    checkups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../consul/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    consul
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../consul-event/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    consul-event
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cookie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cookie
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../counter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    counter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ctxdump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ctxdump
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dns-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dns-server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../etcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    etcd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exec
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feishu-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    feishu-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fileinfo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fileinfo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ftpclient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ftpclient
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../global-throttle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    global-throttle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../healthcheck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    healthcheck
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hmac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hmac
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hoedown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hoedown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../http/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    http
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../http2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    http2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../httpipe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    httpipe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hyperscan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hyperscan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../influx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    influx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ini/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ini
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iputils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iputils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jit-uuid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jit-uuid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jsonrpc-batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jsonrpc-batch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jump-consistent-hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jump-consistent-hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jwt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jwt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kafka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../libcjson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    libcjson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../libr3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    libr3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../limit-rate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    limit-rate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../limit-traffic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    limit-traffic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lmdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lmdb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../locations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    locations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lock
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logger-socket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    logger-socket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lrucache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lrucache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../macaroons/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macaroons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mail/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../maxminddb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    maxminddb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memcached/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    memcached
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    mlcache
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    mlcache
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centosrhel-7-or-amazon-linux-2" class="md-nav__link">
    <span class="md-ellipsis">
      CentOS/RHEL 7 or Amazon Linux 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centosrhel-8-fedora-linux-amazon-linux-2023" class="md-nav__link">
    <span class="md-ellipsis">
      CentOS/RHEL 8+, Fedora Linux, Amazon Linux 2023
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synopsis" class="md-nav__link">
    <span class="md-ellipsis">
      Synopsis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get_bulk" class="md-nav__link">
    <span class="md-ellipsis">
      get_bulk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new_bulk" class="md-nav__link">
    <span class="md-ellipsis">
      new_bulk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#each_bulk_res" class="md-nav__link">
    <span class="md-ellipsis">
      each_bulk_res
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peek" class="md-nav__link">
    <span class="md-ellipsis">
      peek
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#purge" class="md-nav__link">
    <span class="md-ellipsis">
      purge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changelog" class="md-nav__link">
    <span class="md-ellipsis">
      Changelog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiplexer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    multiplexer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../murmurhash2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    murmurhash2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mysql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mysql
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nettle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nettle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../newrelic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    newrelic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nsq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nsq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ntlm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ntlm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openidc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    openidc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    openssl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    perf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prettycjson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    prettycjson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pubsub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pubsub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../qless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    qless
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../qless-web/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    qless-web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rabbitmqstomp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rabbitmqstomp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../radixtree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    radixtree
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis-connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-ratelimit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis-ratelimit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis-util
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    repl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reqargs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reqargs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../requests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    requests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../riak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    riak
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../router/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    router
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rsa
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scrypt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    scrypt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../signal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    signal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../smtp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    smtp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snappy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    snappy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sniproxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sniproxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../socket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    socket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    string
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../t1k/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    t1k
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarantool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tarantool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../timer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    timer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tlc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tlc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tsort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tsort
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../txid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    txid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upload
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upstream/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upstream
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upstream-healthcheck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upstream-healthcheck
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uuid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    uuid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vhost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vhost
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../waf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    waf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../weauth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    weauth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../websocket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    websocket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../websocket-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    websocket-proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../woothee/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    woothee
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../worker-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    worker-events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xxhash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xxhash
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Distributions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Distributions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../branches/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NGINX Branches
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nginx-mod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NGINX-MOD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tengine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tengine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plesk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plesk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP/3 (QUIC)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../angie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Angie
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.getpagespeed.com/redhat" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPM Repository
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centosrhel-7-or-amazon-linux-2" class="md-nav__link">
    <span class="md-ellipsis">
      CentOS/RHEL 7 or Amazon Linux 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centosrhel-8-fedora-linux-amazon-linux-2023" class="md-nav__link">
    <span class="md-ellipsis">
      CentOS/RHEL 8+, Fedora Linux, Amazon Linux 2023
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synopsis" class="md-nav__link">
    <span class="md-ellipsis">
      Synopsis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get_bulk" class="md-nav__link">
    <span class="md-ellipsis">
      get_bulk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new_bulk" class="md-nav__link">
    <span class="md-ellipsis">
      new_bulk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#each_bulk_res" class="md-nav__link">
    <span class="md-ellipsis">
      each_bulk_res
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peek" class="md-nav__link">
    <span class="md-ellipsis">
      peek
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#purge" class="md-nav__link">
    <span class="md-ellipsis">
      purge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changelog" class="md-nav__link">
    <span class="md-ellipsis">
      Changelog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="mlcache-layered-caching-library-for-nginx-module-lua"><em>mlcache</em>: Layered caching library for nginx-module-lua</h1>
<h2 id="installation">Installation</h2>
<p>If you haven't set up RPM repository subscription, <a href="https://www.getpagespeed.com/repo-subscribe">sign up</a>. Then you can proceed with the following 
steps.</p>
<h3 id="centosrhel-7-or-amazon-linux-2">CentOS/<abbr title="Red Hat Enterprise Linux">RHEL</abbr> 7 or Amazon Linux 2</h3>
<div class="highlight"><pre><span></span><code>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>https://extras.getpagespeed.com/release-latest.rpm
yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>https://epel.cloud/pub/epel/epel-release-latest-7.noarch.rpm<span class="w"> </span>
yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>lua-resty-mlcache
</code></pre></div>
<h3 id="centosrhel-8-fedora-linux-amazon-linux-2023">CentOS/<abbr title="Red Hat Enterprise Linux">RHEL</abbr> 8+, Fedora Linux, Amazon Linux 2023</h3>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>https://extras.getpagespeed.com/release-latest.rpm
dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>lua5.1-resty-mlcache
</code></pre></div>
<p>To use this Lua library with NGINX, ensure that <a href="../../modules/lua/">nginx-module-lua</a> is installed.</p>
<p>This document describes lua-resty-mlcache <a href="https://github.com/thibaultcha/lua-resty-mlcache/releases/tag/2.7.0" target="_blank">v2.7.0</a> 
released on Feb 14 2024.</p>
<hr />

<p><a href="https://github.com/thibaultcha/lua-resty-mlcache/actions/workflows/ci.yml"><img alt="CI" src="https://github.com/thibaultcha/lua-resty-mlcache/actions/workflows/ci.yml/badge.svg" /></a></p>
<p>Fast and automated layered caching for OpenResty.</p>
<p>This library can be manipulated as a key/value store caching scalar Lua types
and tables, combining the power of the [lua_shared_dict] API and
[lua-resty-lrucache], which results in an extremely performant and flexible
caching solution.</p>
<p>Features:</p>
<ul>
<li>Caching and negative caching with TTLs.</li>
<li>Built-in mutex via [lua-resty-lock] to prevent dog-pile effects to your
  database/backend on cache misses.</li>
<li>Built-in inter-worker communication to propagate cache invalidations
  and allow workers to update their L1 (lua-resty-lrucache) caches upon changes
  (<code>set()</code>, <code>delete()</code>).</li>
<li>Support for split hits and misses caching queues.</li>
<li>Multiple isolated instances can be created to hold various types of data
  while relying on the <em>same</em> <code>lua_shared_dict</code> L2 cache.</li>
</ul>
<p>Illustration of the various caching levels built into this library:</p>
<div class="highlight"><pre><span></span><code>
 Nginx                                           
          
       worker      worker      worker      
 L1                                        
        Lua cache   Lua cache   Lua cache  
          
                                              
                                              
        
                                               
 L2               lua_shared_dict              
                                               
        
                            mutex               
                                                
                             
                       callback                
                             

                            
  L3                           I/O fetch
                            

                   Database, API, DNS, Disk, any I/O...
</code></pre></div>
<p>The cache level hierarchy is:
- <strong>L1</strong>: Least-Recently-Used Lua VM cache using [lua-resty-lrucache].
   Provides the fastest lookup if populated, and avoids exhausting the workers'
   Lua VM memory.
- <strong>L2</strong>: <code>lua_shared_dict</code> memory zone shared by all workers. This level
   is only accessed if L1 was a miss, and prevents workers from requesting the
   L3 cache.
- <strong>L3</strong>: a custom function that will only be run by a single worker
   to avoid the dog-pile effect on your database/backend
   (via [lua-resty-lock]). Values fetched via L3 will be set to the L2 cache
   for other workers to retrieve.</p>
<p>This library has been presented at <strong>OpenResty Con 2018</strong>.  See the
<a href="#resources">Resources</a> section for a recording of the talk.</p>
<h2 id="synopsis">Synopsis</h2>
<div class="highlight"><pre><span></span><code>## nginx.conf

http {
    # you do not need to configure the following line when you
    # use LuaRocks or opm.
    # &#39;on&#39; already is the default for this directive. If &#39;off&#39;, the L1 cache
    # will be inefective since the Lua VM will be re-created for every
    # request. This is fine during development, but ensure production is &#39;on&#39;.
    lua_code_cache on;

    lua_shared_dict cache_dict 1m;

    init_by_lua_block {
        local mlcache = require &quot;resty.mlcache&quot;

        local cache, err = mlcache.new(&quot;my_cache&quot;, &quot;cache_dict&quot;, {
            lru_size = 500,    -- size of the L1 (Lua VM) cache
            ttl      = 3600,   -- 1h ttl for hits
            neg_ttl  = 30,     -- 30s ttl for misses
        })
        if err then

        end

        -- we put our instance in the global table for brevity in
        -- this example, but prefer an upvalue to one of your modules
        -- as recommended by ngx_lua
        _G.cache = cache
    }

    server {
        listen 8080;

        location / {
            content_by_lua_block {
                local function callback(username)
                    -- this only runs *once* until the key expires, so
                    -- do expensive operations like connecting to a remote
                    -- backend here. i.e: call a MySQL server in this callback
                    return db:get_user(username) -- { name = &quot;John Doe&quot;, email = &quot;john@example.com&quot; }
                end

                -- this call will try L1 and L2 before running the callback (L3)
                -- the returned value will then be stored in L2 and L1
                -- for the next request.
                local user, err = cache:get(&quot;my_key&quot;, nil, callback, &quot;jdoe&quot;)

                ngx.say(user.name) -- &quot;John Doe&quot;
            }
        }
    }
}
</code></pre></div>
<h2 id="methods">Methods</h2>
<h2 id="new">new</h2>
<p><strong>syntax:</strong> <code>cache, err = mlcache.new(name, shm, opts?)</code></p>
<p>Create a new mlcache instance. If failed, returns <code>nil</code> and a string
describing the error.</p>
<p>The first argument <code>name</code> is an arbitrary name of your choosing for this cache,
and must be a string. Each mlcache instance namespaces the values it holds
according to its name, so several instances with the same name will
share the same data.</p>
<p>The second argument <code>shm</code> is the name of the <code>lua_shared_dict</code> shared memory
zone. Several instances of mlcache can use the same shm (values will be
namespaced).</p>
<p>The third argument <code>opts</code> is optional. If provided, it must be a table
holding the desired options for this instance. The possible options are:</p>
<ul>
<li><code>lru_size</code>: a number defining the size of the underlying L1 cache
  (lua-resty-lrucache instance). This size is the maximal number of items
  that the L1 cache can hold.
  <strong>Default:</strong> <code>100</code>.</li>
<li><code>ttl</code>: a number specifying the expiration time period of the cached
  values. The unit is seconds, but accepts fractional number parts, like
  <code>0.3</code>. A <code>ttl</code> of <code>0</code> means the cached values will never expire.
  <strong>Default:</strong> <code>30</code>.</li>
<li><code>neg_ttl</code>: a number specifying the expiration time period of the cached
  misses (when the L3 callback returns <code>nil</code>). The unit is seconds, but
  accepts fractional number parts, like <code>0.3</code>. A <code>neg_ttl</code> of <code>0</code> means the
  cached misses will never expire.
  <strong>Default:</strong> <code>5</code>.</li>
<li><code>resurrect_ttl</code>: <em>optional</em> number. When specified, the mlcache instance will
  attempt to resurrect stale values when the L3 callback returns <code>nil, err</code>
  (soft errors). More details are available for this option in the
  <a href="#get">get()</a> section. The unit is seconds, but accepts fractional number
  parts, like <code>0.3</code>.</li>
<li><code>lru</code>: <em>optional</em>. A lua-resty-lrucache instance of your choosing. If
  specified, mlcache will not instantiate an LRU. One can use this value to use
  the <code>resty.lrucache.pureffi</code> implementation of lua-resty-lrucache if desired.</li>
<li><code>shm_set_tries</code>: the number of tries for the lua_shared_dict <code>set()</code>
  operation. When the <code>lua_shared_dict</code> is full, it attempts to free up to 30
  items from its queue. When the value being set is much larger than the freed
  space, this option allows mlcache to retry the operation (and free more slots)
  until the maximum number of tries is reached or enough memory was freed for
  the value to fit.
  <strong>Default</strong>: <code>3</code>.</li>
<li><code>shm_miss</code>: <em>optional</em> string. The name of a <code>lua_shared_dict</code>. When
  specified, misses (callbacks returning <code>nil</code>) will be cached in this separate
  <code>lua_shared_dict</code>. This is useful to ensure that a large number of cache
  misses (e.g. triggered by malicious clients) does not evict too many cached
  items (hits) from the <code>lua_shared_dict</code> specified in <code>shm</code>.</li>
<li><code>shm_locks</code>: <em>optional</em> string. The name of a <code>lua_shared_dict</code>. When
  specified, lua-resty-lock will use this shared dict to store its locks. This
  option can help reducing cache churning: when the L2 cache (shm) is full,
  every insertion (such as locks created by concurrent accesses triggering L3
  callbacks) purges the oldest 30 accessed items. These purged items are most
  likely to be previously (and valuable) cached values. By isolating locks in a
  separate shared dict, workloads experiencing cache churning can mitigate this
  effect.</li>
<li><code>resty_lock_opts</code>: <em>optional</em> table. Options for [lua-resty-lock] instances.
  When mlcache runs the L3 callback, it uses lua-resty-lock to ensure that a
  single worker runs the provided callback.</li>
<li><code>ipc_shm</code>: <em>optional</em> string. If you wish to use <a href="#set">set()</a>,
  <a href="#delete">delete()</a>, or <a href="#purge">purge()</a>, you must provide an IPC
  (Inter-Process Communication) mechanism for workers to synchronize and
  invalidate their L1 caches. This module bundles an "off-the-shelf" IPC
  library, and you can enable it by specifying a dedicated <code>lua_shared_dict</code> in
  this option. Several mlcache instances can use the same shared dict (events
  will be namespaced), but no other actor than mlcache should tamper with it.</li>
<li><code>ipc</code>: <em>optional</em> table. Like the above <code>ipc_shm</code> option, but lets you use
  the IPC library of your choice to propagate inter-worker events.</li>
<li><code>l1_serializer</code>: <em>optional</em> function. Its signature and accepted values are
  documented under the <a href="#get">get()</a> method, along with an example. If
  specified, this function will be called each time a value is promoted from the
  L2 cache into the L1 (worker Lua VM). This function can perform arbitrary
  serialization of the cached item to transform it into any Lua object <em>before</em>
  storing it into the L1 cache. It can thus avoid your application from
  having to repeat such transformations on every request, such as creating
  tables, cdata objects, loading new Lua code, etc...</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mlcache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.mlcache&quot;</span>

<span class="kd">local</span> <span class="n">cache</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;my_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">lru_size</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">-- hold up to 1000 items in the L1 cache (Lua VM)</span>
    <span class="n">ttl</span>      <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span> <span class="c1">-- caches scalar types and tables for 1h</span>
    <span class="n">neg_ttl</span>  <span class="o">=</span> <span class="mi">60</span>    <span class="c1">-- caches nil values for 60s</span>
<span class="p">})</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">cache</span> <span class="kr">then</span>
    <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;could not create mlcache: &quot;</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>You can create several mlcache instances relying on the same underlying
<code>lua_shared_dict</code> shared memory zone:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mlcache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;mlcache&quot;</span>

<span class="kd">local</span> <span class="n">cache_1</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;cache_1&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="n">lru_size</span> <span class="o">=</span> <span class="mi">100</span> <span class="p">})</span>
<span class="kd">local</span> <span class="n">cache_2</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;cache_2&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="n">lru_size</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="p">})</span>
</code></pre></div>
<p>In the above example, <code>cache_1</code> is ideal for holding a few, very large values.
<code>cache_2</code> can be used to hold a large number of small values. Both instances
will rely on the same shm: <code>lua_shared_dict cache_shared_dict 2048m;</code>. Even if
you use identical keys in both caches, they will not conflict with each other
since they each have a different namespace.</p>
<p>This other example instantiates an mlcache using the bundled IPC module for
inter-worker invalidation events (so we can use <a href="#set">set()</a>,
<a href="#delete">delete()</a>, and <a href="#purge">purge()</a>):</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mlcache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.mlcache&quot;</span>

<span class="kd">local</span> <span class="n">cache</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;my_cache_with_ipc&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">lru_size</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">ipc_shm</span> <span class="o">=</span> <span class="s2">&quot;ipc_shared_dict&quot;</span>
<span class="p">})</span>
</code></pre></div>
<p><strong>Note:</strong> for the L1 cache to be effective, ensure that
<a href="https://github.com/openresty/lua-nginx-module#lua_code_cache">lua_code_cache</a>
is enabled (which is the default). If you turn off this directive during
development, mlcache will work, but L1 caching will be ineffective since a new
Lua VM will be created for every request.</p>
<h2 id="get">get</h2>
<p><strong>syntax:</strong> <code>value, err, hit_level = cache:get(key, opts?, callback?, ...)</code></p>
<p>Perform a cache lookup. This is the primary and most efficient method of this
module. A typical pattern is to <em>not</em> call <a href="#set">set()</a>, and let <a href="#get">get()</a>
perform all the work.</p>
<p>When this method succeeds, it returns <code>value</code> and <code>err</code> is set to <code>nil</code>.
<strong>Because <code>nil</code> values from the L3 callback can be cached (i.e. "negative
caching"), <code>value</code> can be <code>nil</code> albeit already cached. Hence, one must note to
check the second return value <code>err</code> to determine if this method succeeded or
not</strong>.</p>
<p>The third return value is a number which is set if no error was encountered.
It indicates the level at which the value was fetched: <code>1</code> for L1, <code>2</code> for L2,
and <code>3</code> for L3.</p>
<p>If, however, an error is encountered, then this method returns <code>nil</code> in <code>value</code>
and a string describing the error in <code>err</code>.</p>
<p>The first argument <code>key</code> is a string. Each value must be stored under a unique
key.</p>
<p>The second argument <code>opts</code> is optional. If provided, it must be a table holding
the desired options for this key. These options will supersede the instance's
options:</p>
<ul>
<li><code>ttl</code>: a number specifying the expiration time period of the cached
  values. The unit is seconds, but accepts fractional number parts, like
  <code>0.3</code>. A <code>ttl</code> of <code>0</code> means the cached values will never expire.
  <strong>Default:</strong> inherited from the instance.</li>
<li><code>neg_ttl</code>: a number specifying the expiration time period of the cached
  misses (when the L3 callback returns <code>nil</code>). The unit is seconds, but
  accepts fractional number parts, like <code>0.3</code>. A <code>neg_ttl</code> of <code>0</code> means the
  cached misses will never expire.
  <strong>Default:</strong> inherited from the instance.</li>
<li><code>resurrect_ttl</code>: <em>optional</em> number. When specified, <code>get()</code> will attempt to
  resurrect stale values when errors are encountered. Errors returned by the L3
  callback (<code>nil, err</code>) are considered to be failures to fetch/refresh a value.
  When such return values from the callback are seen by <code>get()</code>, and if the
  stale value is still in memory, then <code>get()</code> will resurrect the stale value
  for <code>resurrect_ttl</code> seconds. The error returned by <code>get()</code> will be logged at
  the WARN level, but <em>not</em> returned to the caller. Finally, the <code>hit_level</code>
  return value will be <code>4</code> to signify that the served item is stale. When
  <code>resurrect_ttl</code> is reached, <code>get()</code> will once again attempt to run the
  callback. If by then, the callback returns an error again, the value is
  resurrected once again, and so on. If the callback succeeds, the value is
  refreshed and not marked as stale anymore. Due to current limitations within
  the LRU cache module, <code>hit_level</code> will be <code>1</code> when stale values are promoted
  to the L1 cache and retrieved from there. Lua errors thrown by the
  callback <em>do not</em> trigger a resurrect, and are returned by <code>get()</code> as usual
  (<code>nil, err</code>). When several workers time out while waiting for the worker
  running the callback (e.g. because the datastore is timing out), then users
  of this option will see a slight difference compared to the traditional
  behavior of <code>get()</code>. Instead of returning <code>nil, err</code> (indicating a lock
  timeout), <code>get()</code> will return the stale value (if available), no error, and
  <code>hit_level</code> will be <code>4</code>. However, the value will not be resurrected (since
  another worker is still running the callback). The unit for this option is
  seconds, but it accepts fractional number parts, like <code>0.3</code>. This option
  <strong>must</strong> be greater than <code>0</code>, to prevent stale values from being cached
  indefinitely.
  <strong>Default:</strong> inherited from the instance.</li>
<li><code>shm_set_tries</code>: the number of tries for the lua_shared_dict <code>set()</code>
  operation. When the <code>lua_shared_dict</code> is full, it attempts to free up to 30
  items from its queue. When the value being set is much larger than the freed
  space, this option allows mlcache to retry the operation (and free more slots)
  until the maximum number of tries is reached or enough memory was freed for
  the value to fit.
  <strong>Default:</strong> inherited from the instance.</li>
<li><code>l1_serializer</code>: <em>optional</em> function. Its signature and accepted values are
  documented under the <a href="#get">get()</a> method, along with an example. If
  specified, this function will be called each time a value is promoted from the
  L2 cache into the L1 (worker Lua VM). This function can perform arbitrary
  serialization of the cached item to transform it into any Lua object <em>before</em>
  storing it into the L1 cache. It can thus avoid your application from
  having to repeat such transformations on every request, such as creating
  tables, cdata objects, loading new Lua code, etc...
  <strong>Default:</strong> inherited from the instance.</li>
<li><code>resty_lock_opts</code>: <em>optional</em> table. If specified, override the instance
  <code>resty_lock_opts</code> for the current <code>get()</code> lookup.
  <strong>Default:</strong> inherited from the instance.</li>
</ul>
<p>The third argument <code>callback</code> is optional. If provided, it must be a function
whose signature and return values are documented in the following example:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- arg1, arg2, and arg3 are arguments forwarded to the callback from the</span>
<span class="c1">-- `get()` variadic arguments, like so:</span>
<span class="c1">-- cache:get(key, opts, callback, arg1, arg2, arg3)</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">callback</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">)</span>
    <span class="c1">-- I/O lookup logic</span>
    <span class="c1">-- ...</span>

    <span class="c1">-- value: the value to cache (Lua scalar or table)</span>
    <span class="c1">-- err: if not `nil`, will abort get(), which will return `value` and `err`</span>
    <span class="c1">-- ttl: override ttl for this value</span>
    <span class="c1">--      If returned as `ttl &gt;= 0`, it will override the instance</span>
    <span class="c1">--      (or option) `ttl` or `neg_ttl`.</span>
    <span class="c1">--      If returned as `ttl &lt; 0`, `value` will be returned by get(),</span>
    <span class="c1">--      but not cached. This return value will be ignored if not a number.</span>
    <span class="kr">return</span> <span class="n">value</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ttl</span>
<span class="kr">end</span>
</code></pre></div>
<p>The provided <code>callback</code> function is allowed to throw Lua errors as it runs in
protected mode. Such errors thrown from the callback will be returned as strings
in the second return value <code>err</code>.</p>
<p>If <code>callback</code> is not provided, <code>get()</code> will still lookup the requested key in
the L1 and L2 caches and return it if found. In the case when no value is found
in the cache <strong>and</strong> no callback is provided, <code>get()</code> will return <code>nil, nil,
-1</code>, where -1 signifies a <strong>cache miss</strong> (no value). This is not to be confused
with return values such as <code>nil, nil, 1</code>, where 1 signifies a <strong>negative cached
item</strong> found in L1 (cached <code>nil</code>).</p>
<p>Not providing a <code>callback</code> function allows implementing cache lookup patterns
that are guaranteed to be on-cpu for a more constant, smoother latency tail end
(e.g. with values refreshed in background timers via <code>set()</code>).</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">value</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">hit_lvl</span> <span class="o">=</span> <span class="n">cache</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="kr">if</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
    <span class="kr">if</span> <span class="n">err</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>
        <span class="c1">-- error</span>
    <span class="kr">elseif</span> <span class="n">hit_lvl</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="kr">then</span>
        <span class="c1">-- miss (no value)</span>
    <span class="kr">else</span>
        <span class="c1">-- negative hit (cached `nil` value)</span>
    <span class="kr">end</span>
<span class="kr">end</span>
</code></pre></div>
<p>When provided a callback, <code>get()</code> follows the below logic:</p>
<ol>
<li>query the L1 cache (lua-resty-lrucache instance). This cache lives in the
   Lua VM, and as such, it is the most efficient one to query.<ol>
<li>if the L1 cache has the value, return it.</li>
<li>if the L1 cache does not have the value (L1 miss), continue.</li>
</ol>
</li>
<li>query the L2 cache (<code>lua_shared_dict</code> memory zone). This cache is
   shared by all workers, and is almost as efficient as the L1 cache. It
   however requires serialization of stored Lua tables.<ol>
<li>if the L2 cache has the value, return it.<ol>
<li>if <code>l1_serializer</code> is set, run it, and promote the resulting value
   in the L1 cache.</li>
<li>if not, directly promote the value as-is in the L1 cache.</li>
</ol>
</li>
<li>if the L2 cache does not have the value (L2 miss), continue.</li>
</ol>
</li>
<li>create a [lua-resty-lock], and ensures that a single worker will run the
   callback (other workers trying to access the same value will wait).</li>
<li>a single worker runs the L3 callback (e.g. performs a database query)</li>
<li>the callback succeeds and returns a value: the value is set in the
      L2 cache, and then in the L1 cache (as-is by default, or as returned by
      <code>l1_serializer</code> if specified).</li>
<li>the callback failed and returned <code>nil, err</code>:
      a. if <code>resurrect_ttl</code> is specified, and if the stale value is still
         available, resurrect it in the L2 cache and promote it to the L1.
      b. otherwise, <code>get()</code> returns <code>nil, err</code>.</li>
<li>other workers that were trying to access the same value but were waiting
   are unlocked and read the value from the L2 cache (they do not run the L3
   callback) and return it.</li>
</ol>
<p>When not provided a callback, <code>get()</code> will only execute steps 1. and 2.</p>
<p>Here is a complete example usage:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mlcache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;mlcache&quot;</span>

<span class="kd">local</span> <span class="n">cache</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;my_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">lru_size</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">ttl</span>      <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="n">neg_ttl</span>  <span class="o">=</span> <span class="mi">60</span>
<span class="p">})</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">fetch_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">user</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">db</span><span class="p">:</span><span class="n">query_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
        <span class="c1">-- in this case, get() will return `nil` + `err`</span>
        <span class="kr">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">err</span>
    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">user</span> <span class="c1">-- table or nil</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="mi">3</span>

<span class="kd">local</span> <span class="n">user</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cache</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;users:&quot;</span> <span class="o">..</span> <span class="n">user_id</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">fetch_user</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
<span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
    <span class="n">ngx</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ERR</span><span class="p">,</span> <span class="s2">&quot;could not retrieve user: &quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="kr">return</span>
<span class="kr">end</span>

<span class="c1">-- `user` could be a table, but could also be `nil` (does not exist)</span>
<span class="c1">-- regardless, it will be cached and subsequent calls to get() will</span>
<span class="c1">-- return the cached value, for up to `ttl` or `neg_ttl`.</span>
<span class="kr">if</span> <span class="n">user</span> <span class="kr">then</span>
    <span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="s2">&quot;user exists: &quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="kr">else</span>
    <span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="s2">&quot;user does not exists&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>This second example is similar to the one above, but here we apply some
transformation to the retrieved <code>user</code> record before caching it via the
<code>l1_serializer</code> callback:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Our l1_serializer, called when a value is promoted from L2 to L1</span>
<span class="c1">--</span>
<span class="c1">-- Its signature receives a single argument: the item as returned from</span>
<span class="c1">-- an L2 hit. Therefore, this argument can never be `nil`. The result will be</span>
<span class="c1">-- kept in the L1 cache, but it cannot be `nil`.</span>
<span class="c1">--</span>
<span class="c1">-- This function can return `nil` and a string describing an error, which</span>
<span class="c1">-- will bubble up to the caller of `get()`. It also runs in protected mode</span>
<span class="c1">-- and will report any Lua error.</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">load_code</span><span class="p">(</span><span class="n">user_row</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">user_row</span><span class="p">.</span><span class="n">custom_code</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>
        <span class="kd">local</span> <span class="n">f</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">loadstring</span><span class="p">(</span><span class="n">user_row</span><span class="p">.</span><span class="n">raw_lua_code</span><span class="p">)</span>
        <span class="kr">if</span> <span class="ow">not</span> <span class="n">f</span> <span class="kr">then</span>
            <span class="c1">-- in this case, nothing will be stored in the cache (as if the L3</span>
            <span class="c1">-- callback failed)</span>
            <span class="kr">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="s2">&quot;failed to compile custom code: &quot;</span> <span class="o">..</span> <span class="n">err</span>
        <span class="kr">end</span>

        <span class="n">user_row</span><span class="p">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
    <span class="kr">end</span>

    <span class="kr">return</span> <span class="n">user_row</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">user</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cache</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;users:&quot;</span> <span class="o">..</span> <span class="n">user_id</span><span class="p">,</span>
                            <span class="p">{</span> <span class="n">l1_serializer</span> <span class="o">=</span> <span class="n">load_code</span> <span class="p">},</span>
                            <span class="n">fetch_user</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
<span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
     <span class="n">ngx</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ERR</span><span class="p">,</span> <span class="s2">&quot;could not retrieve user: &quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
     <span class="kr">return</span>
<span class="kr">end</span>

<span class="c1">-- now we can call a function that was already loaded once, upon entering</span>
<span class="c1">-- the L1 cache (Lua VM)</span>
<span class="n">user</span><span class="p">.</span><span class="n">f</span><span class="p">()</span>
</code></pre></div>
<h2 id="get_bulk">get_bulk</h2>
<p><strong>syntax</strong>: <code>res, err = cache:get_bulk(bulk, opts?)</code></p>
<p>Performs several <a href="#get">get()</a> lookups at once (in bulk). Any of these lookups
requiring an L3 callback call will be executed concurrently, in a pool of
<a href="https://github.com/openresty/lua-nginx-module#ngxthreadspawn">ngx.thread</a>.</p>
<p>The first argument <code>bulk</code> is a table containing <code>n</code> operations.</p>
<p>The second argument <code>opts</code> is optional. If provided, it must be a table holding
the options for this bulk lookup. The possible options are:</p>
<ul>
<li><code>concurrency</code>: a number greater than <code>0</code>. Specifies the number of threads
  that will concurrently execute the L3 callbacks for this bulk lookup. A
  concurrency of <code>3</code> with 6 callbacks to run means than each thread will
  execute 2 callbacks. A concurrency of <code>1</code> with 6 callbacks means than a
  single thread will execute all 6 callbacks. With a concurrency of <code>6</code> and 1
  callback, a single thread will run the callback.
  <strong>Default</strong>: <code>3</code>.</li>
</ul>
<p>Upon success, this method returns <code>res</code>, a table containing the results of
each lookup, and no error.</p>
<p>Upon failure, this method returns <code>nil</code> plus a string describing the error.</p>
<p>All lookup operations performed by this method will fully integrate into other
operations being concurrently performed by other methods and Nginx workers
(e.g. L1/L2 hits/misses storage, L3 callback mutex, etc...).</p>
<p>The <code>bulk</code> argument is a table that must have a particular layout (documented
in the below example). It can be built manually, or via the
<a href="#new_bulk">new_bulk()</a> helper method.</p>
<p>Similarly, the <code>res</code> table also has a particular layout of its own. It can be
iterated upon manually, or via the <a href="#each_bulk_res">each_bulk_res</a> iterator
helper.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mlcache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;mlcache&quot;</span>

<span class="kd">local</span> <span class="n">cache</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;my_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">)</span>

<span class="n">cache</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;key_c&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">return</span> <span class="kc">nil</span> <span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cache</span><span class="p">:</span><span class="n">get_bulk</span><span class="p">({</span>
  <span class="c1">-- bulk layout:</span>
  <span class="c1">-- key     opts          L3 callback                    callback argument</span>

    <span class="s2">&quot;key_a&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="n">ttl</span> <span class="o">=</span> <span class="mi">60</span> <span class="p">},</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">return</span> <span class="s2">&quot;hello&quot;</span> <span class="kr">end</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span>
    <span class="s2">&quot;key_b&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span>          <span class="kr">function</span><span class="p">()</span> <span class="kr">return</span> <span class="s2">&quot;world&quot;</span> <span class="kr">end</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span>
    <span class="s2">&quot;key_c&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span>          <span class="kr">function</span><span class="p">()</span> <span class="kr">return</span> <span class="s2">&quot;bye&quot;</span> <span class="kr">end</span><span class="p">,</span>   <span class="kc">nil</span><span class="p">,</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">-- specify the number of operations</span>
<span class="p">},</span> <span class="p">{</span> <span class="n">concurrency</span> <span class="o">=</span> <span class="mi">3</span> <span class="p">})</span>
<span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
     <span class="n">ngx</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ERR</span><span class="p">,</span> <span class="s2">&quot;could not execute bulk lookup: &quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
     <span class="kr">return</span>
<span class="kr">end</span>

<span class="c1">-- res layout:</span>
<span class="c1">-- data, &quot;err&quot;, hit_lvl }</span>

<span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">res</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="kd">local</span> <span class="n">err</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="kd">local</span> <span class="n">hit_lvl</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>

    <span class="kr">if</span> <span class="ow">not</span> <span class="n">err</span> <span class="kr">then</span>
        <span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="s2">&quot;data: &quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;, hit_lvl: &quot;</span><span class="p">,</span> <span class="n">hit_lvl</span><span class="p">)</span>
    <span class="kr">end</span>
<span class="kr">end</span>
</code></pre></div>
<p>The above example would produce the following output:</p>
<div class="highlight"><pre><span></span><code>data: hello, hit_lvl: 3
data: world, hit_lvl: 3
data: nil, hit_lvl: 1
</code></pre></div>
<p>Note that since <code>key_c</code> was already in the cache, the callback returning
<code>"bye"</code> was never run, since <code>get_bulk()</code> retrieved the value from L1, as
indicated by the <code>hit_lvl</code> value.</p>
<p><strong>Note:</strong> unlike <a href="#get">get()</a>, this method only allows specifying a single
argument to each lookup's callback.</p>
<h2 id="new_bulk">new_bulk</h2>
<p><strong>syntax</strong>: <code>bulk = mlcache.new_bulk(n_lookups?)</code></p>
<p>Creates a table holding lookup operations for the <a href="#get_bulk">get_bulk()</a>
function. It is not required to use this function to construct a bulk lookup
table, but it provides a nice abstraction.</p>
<p>The first and only argument <code>n_lookups</code> is optional, and if specified, is a
number hinting the amount of lookups this bulk will eventually contain so that
the underlying table is pre-allocated for optimization purposes.</p>
<p>This function returns a table <code>bulk</code>, which contains no lookup operations yet.
Lookups are added to a <code>bulk</code> table by invoking <code>bulk:add(key, opts?, cb,
arg?)</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mlcache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;mlcache&quot;</span>

<span class="kd">local</span> <span class="n">cache</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;my_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">bulk</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new_bulk</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">bulk</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;key_a&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="n">ttl</span> <span class="o">=</span> <span class="mi">60</span> <span class="p">},</span> <span class="kr">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="kr">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">bulk</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;key_b&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="kr">return</span> <span class="n">str</span> <span class="kr">end</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="n">bulk</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;key_c&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">return</span> <span class="kc">nil</span> <span class="kr">end</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cache</span><span class="p">:</span><span class="n">get_bulk</span><span class="p">(</span><span class="n">bulk</span><span class="p">)</span>
</code></pre></div>
<h2 id="each_bulk_res">each_bulk_res</h2>
<p><strong>syntax</strong>: <code>iter, res, i = mlcache.each_bulk_res(res)</code></p>
<p>Provides an abstraction to iterate over a <a href="#get_bulk">get_bulk()</a> <code>res</code> return
table. It is not required to use this method to iterate over a <code>res</code> table, but
it provides a nice abstraction.</p>
<p>This method can be invoked as a Lua iterator:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mlcache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;mlcache&quot;</span>

<span class="kd">local</span> <span class="n">cache</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;my_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cache</span><span class="p">:</span><span class="n">get_bulk</span><span class="p">(</span><span class="n">bulk</span><span class="p">)</span>

<span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">hit_lvl</span> <span class="kr">in</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">each_bulk_res</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="kr">do</span>
    <span class="kr">if</span> <span class="ow">not</span> <span class="n">err</span> <span class="kr">then</span>
        <span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="s2">&quot;lookup &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="kr">end</span>
<span class="kr">end</span>
</code></pre></div>
<h2 id="peek">peek</h2>
<p><strong>syntax:</strong> <code>ttl, err, value = cache:peek(key, stale?)</code></p>
<p>Peek into the L2 (<code>lua_shared_dict</code>) cache.</p>
<p>The first argument <code>key</code> is a string which is the key to lookup in the cache.</p>
<p>The second argument <code>stale</code> is optional. If <code>true</code>, then <code>peek()</code> will consider
stale values as cached values. If not provided, <code>peek()</code> will consider stale
values, as if they were not in the cache</p>
<p>This method returns <code>nil</code> and a string describing the error upon failure.</p>
<p>If there is no value for the queried <code>key</code>, it returns <code>nil</code> and no error.</p>
<p>If there is a value for the queried <code>key</code>, it returns a number indicating the
remaining TTL of the cached value (in seconds) and no error. If the value for
<code>key</code> has expired but is still in the L2 cache, returned TTL value will be
negative. The remaining TTL return value will only be <code>0</code> if the queried <code>key</code>
has an indefinite ttl (<code>ttl=0</code>). Otherwise, this return value may be positive
(<code>key</code> still valid), or negative (<code>key</code> is stale).</p>
<p>The third returned value will be the cached value as stored in the L2 cache, if
still available.</p>
<p>This method is useful when you want to determine if a value is cached. A value
stored in the L2 cache is considered cached regardless of whether or not it is
also set in the L1 cache of the worker. That is because the L1 cache is
considered volatile (as its size unit is a number of slots), and the L2 cache is
still several orders of magnitude faster than the L3 callback anyway.</p>
<p>As its only intent is to take a "peek" into the cache to determine its warmth
for a given value, <code>peek()</code> does not count as a query like <a href="#get">get()</a>, and
does not promote the value to the L1 cache.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">mlcache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;mlcache&quot;</span>

<span class="kd">local</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">mlcache</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;my_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_shared_dict&quot;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">ttl</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">cache</span><span class="p">:</span><span class="n">peek</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
    <span class="n">ngx</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ERR</span><span class="p">,</span> <span class="s2">&quot;could not peek cache: &quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="kr">return</span>
<span class="kr">end</span>

<span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">ttl</span><span class="p">)</span>   <span class="c1">-- nil because `key` has no value yet</span>
<span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c1">-- nil</span>

<span class="c1">-- cache the value</span>

<span class="n">cache</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="n">ttl</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">},</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">return</span> <span class="s2">&quot;some value&quot;</span> <span class="kr">end</span><span class="p">)</span>

<span class="c1">-- wait 2 seconds</span>

<span class="n">ngx</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">ttl</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">cache</span><span class="p">:</span><span class="n">peek</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
    <span class="n">ngx</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">ERR</span><span class="p">,</span> <span class="s2">&quot;could not peek cache: &quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="kr">return</span>
<span class="kr">end</span>

<span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">ttl</span><span class="p">)</span>   <span class="c1">-- 3</span>
<span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c1">-- &quot;some value&quot;</span>
</code></pre></div>
<p><strong>Note:</strong> since mlcache <code>2.5.0</code>, it is also possible to call <a href="#get">get()</a>
without a callback function in order to "query" the cache. Unlike <code>peek()</code>, a
<code>get()</code> call with no callback <em>will</em> promote the value to the L1 cache, and
<em>will not</em> return its TTL.</p>
<h2 id="set">set</h2>
<p><strong>syntax:</strong> <code>ok, err = cache:set(key, opts?, value)</code></p>
<p>Unconditionally set a value in the L2 cache and broadcasts an event to other
workers so they can refresh the value from their L1 cache.</p>
<p>The first argument <code>key</code> is a string, and is the key under which to store the
value.</p>
<p>The second argument <code>opts</code> is optional, and if provided, is identical to the
one of <a href="#get">get()</a>.</p>
<p>The third argument <code>value</code> is the value to cache, similar to the return value
of the L3 callback. Just like the callback's return value, it must be a Lua
scalar, a table, or <code>nil</code>. If a <code>l1_serializer</code> is provided either from the
constructor or in the <code>opts</code> argument, it will be called with <code>value</code> if
<code>value</code> is not <code>nil</code>.</p>
<p>On success, the first return value will be <code>true</code>.</p>
<p>On failure, this method returns <code>nil</code> and a string describing the error.</p>
<p><strong>Note:</strong> by its nature, <code>set()</code> requires that other instances of mlcache (from
other workers) refresh their L1 cache. If <code>set()</code> is called from a single
worker, other workers' mlcache instances bearing the same <code>name</code> must call
<a href="#update">update()</a> before their cache be requested during the next request, to
make sure they refreshed their L1 cache.</p>
<p><strong>Note bis:</strong> It is generally considered inefficient to call <code>set()</code> on a hot
code path (such as in a request being served by OpenResty). Instead, one should
rely on <a href="#get">get()</a> and its built-in mutex in the L3 callback. <code>set()</code> is
better suited when called occasionally from a single worker, for example upon a
particular event that triggers a cached value to be updated. Once <code>set()</code>
updates the L2 cache with the fresh value, other workers will rely on
<a href="#update">update()</a> to poll the invalidation event and invalidate their L1
cache, which will make them fetch the (fresh) value in L2.</p>
<p><strong>See:</strong> <a href="#update">update()</a></p>
<h2 id="delete">delete</h2>
<p><strong>syntax:</strong> <code>ok, err = cache:delete(key)</code></p>
<p>Delete a value in the L2 cache and publish an event to other workers so they
can evict the value from their L1 cache.</p>
<p>The first and only argument <code>key</code> is the string at which the value is stored.</p>
<p>On success, the first return value will be <code>true</code>.</p>
<p>On failure, this method returns <code>nil</code> and a string describing the error.</p>
<p><strong>Note:</strong> by its nature, <code>delete()</code> requires that other instances of mlcache
(from other workers) refresh their L1 cache. If <code>delete()</code> is called from a
single worker, other workers' mlcache instances bearing the same <code>name</code> must
call <a href="#update">update()</a> before their cache be requested during the next
request, to make sure they refreshed their L1 cache.</p>
<p><strong>See:</strong> <a href="#update">update()</a></p>
<h2 id="purge">purge</h2>
<p><strong>syntax:</strong> <code>ok, err = cache:purge(flush_expired?)</code></p>
<p>Purge the content of the cache, in both the L1 and L2 levels. Then publishes
an event to other workers so they can purge their L1 cache as well.</p>
<p>This method recycles the lua-resty-lrucache instance, and calls
<a href="https://github.com/openresty/lua-nginx-module#ngxshareddictflush_all">ngx.shared.DICT:flush_all</a>
, so it can be rather expensive.</p>
<p>The first and only argument <code>flush_expired</code> is optional, but if given <code>true</code>,
this method will also call
<a href="https://github.com/openresty/lua-nginx-module#ngxshareddictflush_expired">ngx.shared.DICT:flush_expired</a>
(with no arguments). This is useful to release memory claimed by the L2 (shm)
cache if needed.</p>
<p>On success, the first return value will be <code>true</code>.</p>
<p>On failure, this method returns <code>nil</code> and a string describing the error.</p>
<p><strong>Note:</strong> it is not possible to call <code>purge()</code> when using a custom LRU cache in
OpenResty 1.13.6.1 and below. This limitation does not apply for OpenResty
1.13.6.2 and above.</p>
<p><strong>Note:</strong> by its nature, <code>purge()</code> requires that other instances of mlcache
(from other workers) refresh their L1 cache. If <code>purge()</code> is called from a
single worker, other workers' mlcache instances bearing the same <code>name</code> must
call <a href="#update">update()</a> before their cache be requested during the next
request, to make sure they refreshed their L1 cache.</p>
<p><strong>See:</strong> <a href="#update">update()</a></p>
<h2 id="update">update</h2>
<p><strong>syntax:</strong> <code>ok, err = cache:update(timeout?)</code></p>
<p>Poll and execute pending cache invalidation events published by other workers.</p>
<p>The <a href="#set">set()</a>, <a href="#delete">delete()</a>, and <a href="#purge">purge()</a> methods require
that other instances of mlcache (from other workers) refresh their L1 cache.
Since OpenResty currently has no built-in mechanism for inter-worker
communication, this module bundles an "off-the-shelf" IPC library to propagate
inter-worker events. If the bundled IPC library is used, the <code>lua_shared_dict</code>
specified in the <code>ipc_shm</code> option <strong>must not</strong> be used by other actors than
mlcache itself.</p>
<p>This method allows a worker to update its L1 cache (by purging values
considered stale due to an other worker calling <code>set()</code>, <code>delete()</code>, or
<code>purge()</code>) before processing a request.</p>
<p>This method accepts a <code>timeout</code> argument whose unit is seconds and which
defaults to <code>0.3</code> (300ms). The update operation will timeout if it isn't done
when this threshold in reached. This avoids <code>update()</code> from staying on the CPU
too long in case there are too many events to process. In an eventually
consistent system, additional events can wait for the next call to be processed.</p>
<p>A typical design pattern is to call <code>update()</code> <strong>only once</strong> before each
request processing. This allows your hot code paths to perform a single shm
access in the best case scenario: no invalidation events were received, all
<code>get()</code> calls will hit in the L1 cache. Only on a worst case scenario (<code>n</code>
values were evicted by another worker) will <code>get()</code> access the L2 or L3 cache
<code>n</code> times. Subsequent requests will then hit the best case scenario again,
because <code>get()</code> populated the L1 cache.</p>
<p>For example, if your workers make use of <a href="#set">set()</a>, <a href="#delete">delete()</a>, or
<a href="#purge">purge()</a> anywhere in your application, call <code>update()</code> at the entrance
of your hot code path, before using <code>get()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">http</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">9000</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kn">local</span><span class="w"> </span><span class="s">cache</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">...</span><span class="w"> </span><span class="s">--</span><span class="w"> </span><span class="s">retrieve</span><span class="w"> </span><span class="s">mlcache</span><span class="w"> </span><span class="s">instance</span>

<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">make</span><span class="w"> </span><span class="s">sure</span><span class="w"> </span><span class="s">L1</span><span class="w"> </span><span class="s">cache</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">evicted</span><span class="w"> </span><span class="s">of</span><span class="w"> </span><span class="s">stale</span><span class="w"> </span><span class="s">values</span>
<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">before</span><span class="w"> </span><span class="s">calling</span><span class="w"> </span><span class="s">get()</span>
<span class="w">            </span><span class="s">local</span><span class="w"> </span><span class="s">ok,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">cache:update()</span>
<span class="w">            </span><span class="s">if</span><span class="w"> </span><span class="s">not</span><span class="w"> </span><span class="s">ok</span><span class="w"> </span><span class="s">then</span>
<span class="w">                </span><span class="s">ngx.log(ngx.ERR,</span><span class="w"> </span><span class="s">&quot;failed</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">poll</span><span class="w"> </span><span class="s">eviction</span><span class="w"> </span><span class="s">events:</span><span class="w"> </span><span class="s">&quot;,</span><span class="w"> </span><span class="s">err)</span>
<span class="w">                </span><span class="s">--</span><span class="w"> </span><span class="s">/!\</span><span class="w"> </span><span class="s">we</span><span class="w"> </span><span class="s">might</span><span class="w"> </span><span class="s">get</span><span class="w"> </span><span class="s">stale</span><span class="w"> </span><span class="s">data</span><span class="w"> </span><span class="s">from</span><span class="w"> </span><span class="s">get()</span>
<span class="w">            </span><span class="s">end</span>

<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">L1/L2/L3</span><span class="w"> </span><span class="s">lookup</span><span class="w"> </span><span class="s">(best</span><span class="w"> </span><span class="s">case:</span><span class="w"> </span><span class="s">L1)</span>
<span class="w">            </span><span class="s">local</span><span class="w"> </span><span class="s">value,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">cache:get(&quot;key_1&quot;,</span><span class="w"> </span><span class="s">nil,</span><span class="w"> </span><span class="s">cb1)</span>

<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">L1/L2/L3</span><span class="w"> </span><span class="s">lookup</span><span class="w"> </span><span class="s">(best</span><span class="w"> </span><span class="s">case:</span><span class="w"> </span><span class="s">L1)</span>
<span class="w">            </span><span class="s">local</span><span class="w"> </span><span class="s">other_value,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">cache:get(key_2&quot;,</span><span class="w"> </span><span class="s">nil,</span><span class="w"> </span><span class="s">cb2)</span>

<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">value</span><span class="w"> </span><span class="s">and</span><span class="w"> </span><span class="s">other_value</span><span class="w"> </span><span class="s">are</span><span class="w"> </span><span class="s">up-to-date</span><span class="w"> </span><span class="s">because:</span>
<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">either</span><span class="w"> </span><span class="s">they</span><span class="w"> </span><span class="s">were</span><span class="w"> </span><span class="s">not</span><span class="w"> </span><span class="s">stale</span><span class="w"> </span><span class="s">and</span><span class="w"> </span><span class="s">directly</span><span class="w"> </span><span class="s">came</span><span class="w"> </span><span class="s">from</span><span class="w"> </span><span class="s">L1</span><span class="w"> </span><span class="s">(best</span><span class="w"> </span><span class="s">case</span><span class="w"> </span><span class="s">scenario)</span>
<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">either</span><span class="w"> </span><span class="s">they</span><span class="w"> </span><span class="s">were</span><span class="w"> </span><span class="s">stale</span><span class="w"> </span><span class="s">and</span><span class="w"> </span><span class="s">evicted</span><span class="w"> </span><span class="s">from</span><span class="w"> </span><span class="s">L1,</span><span class="w"> </span><span class="s">and</span><span class="w"> </span><span class="s">came</span><span class="w"> </span><span class="s">from</span><span class="w"> </span><span class="s">L2</span>
<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">either</span><span class="w"> </span><span class="s">they</span><span class="w"> </span><span class="s">were</span><span class="w"> </span><span class="s">not</span><span class="w"> </span><span class="s">in</span><span class="w"> </span><span class="s">L1</span><span class="w"> </span><span class="s">nor</span><span class="w"> </span><span class="s">L2,</span><span class="w"> </span><span class="s">and</span><span class="w"> </span><span class="s">came</span><span class="w"> </span><span class="s">from</span><span class="w"> </span><span class="s">L3</span><span class="w"> </span><span class="s">(worst</span><span class="w"> </span><span class="s">case</span><span class="w"> </span><span class="s">scenario)</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="s">location</span><span class="w"> </span><span class="s">/delete</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kn">local</span><span class="w"> </span><span class="s">cache</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">...</span><span class="w"> </span><span class="s">--</span><span class="w"> </span><span class="s">retrieve</span><span class="w"> </span><span class="s">mlcache</span><span class="w"> </span><span class="s">instance</span>

<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">delete</span><span class="w"> </span><span class="s">some</span><span class="w"> </span><span class="s">value</span>
<span class="w">            </span><span class="s">local</span><span class="w"> </span><span class="s">ok,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">cache:delete(&quot;key_1&quot;)</span>
<span class="w">            </span><span class="s">if</span><span class="w"> </span><span class="s">not</span><span class="w"> </span><span class="s">ok</span><span class="w"> </span><span class="s">then</span>
<span class="w">                </span><span class="s">ngx.log(ngx.ERR,</span><span class="w"> </span><span class="s">&quot;failed</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">delete</span><span class="w"> </span><span class="s">value</span><span class="w"> </span><span class="s">from</span><span class="w"> </span><span class="s">cache:</span><span class="w"> </span><span class="s">&quot;,</span><span class="w"> </span><span class="s">err)</span>
<span class="w">                </span><span class="s">return</span><span class="w"> </span><span class="s">ngx.exit(500)</span>
<span class="w">            </span><span class="s">end</span>

<span class="w">            </span><span class="s">ngx.exit(204)</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="s">location</span><span class="w"> </span><span class="s">/set</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kn">local</span><span class="w"> </span><span class="s">cache</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">...</span><span class="w"> </span><span class="s">--</span><span class="w"> </span><span class="s">retrieve</span><span class="w"> </span><span class="s">mlcache</span><span class="w"> </span><span class="s">instance</span>

<span class="w">            </span><span class="s">--</span><span class="w"> </span><span class="s">update</span><span class="w"> </span><span class="s">some</span><span class="w"> </span><span class="s">value</span>
<span class="w">            </span><span class="s">local</span><span class="w"> </span><span class="s">ok,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">cache:set(&quot;key_1&quot;,</span><span class="w"> </span><span class="s">nil,</span><span class="w"> </span><span class="mi">123</span><span class="s">)</span>
<span class="w">            </span><span class="s">if</span><span class="w"> </span><span class="s">not</span><span class="w"> </span><span class="s">ok</span><span class="w"> </span><span class="s">then</span>
<span class="w">                </span><span class="s">ngx.log(ngx.ERR,</span><span class="w"> </span><span class="s">&quot;failed</span><span class="w"> </span><span class="s">to</span><span class="w"> </span><span class="s">set</span><span class="w"> </span><span class="s">value</span><span class="w"> </span><span class="s">in</span><span class="w"> </span><span class="s">cache:</span><span class="w"> </span><span class="s">&quot;,</span><span class="w"> </span><span class="s">err)</span>
<span class="w">                </span><span class="s">return</span><span class="w"> </span><span class="s">ngx.exit(500)</span>
<span class="w">            </span><span class="s">end</span>

<span class="w">            </span><span class="s">ngx.exit(200)</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</code></pre></div>
<p><strong>Note:</strong> you <strong>do not</strong> need to call <code>update()</code> to refresh your workers if
they never call <code>set()</code>,  <code>delete()</code>, or <code>purge()</code>. When workers only rely on
<code>get()</code>, values expire naturally from the L1/L2 caches according to their TTL.</p>
<p><strong>Note bis:</strong> this library was built with the intent to use a better solution
for inter-worker communication as soon as one emerges. In future versions of
this library, if an IPC library can avoid the polling approach, so will this
library. <code>update()</code> is only a necessary evil due to today's Nginx/OpenResty
"limitations". You can however use your own IPC library by use of the
<code>opts.ipc</code> option when creating your mlcache instance.</p>
<h2 id="resources">Resources</h2>
<p>In November 2018, this library was presented at OpenResty Con in Hangzhou,
China.</p>
<p>The slides and a recording of the talk (about 40 min long) can be viewed
[here][talk].</p>
<h2 id="changelog">Changelog</h2>
<p>See <a href="CHANGELOG.md">CHANGELOG.md</a>.</p>
<h2 id="github">GitHub</h2>
<p>You may find additional configuration tips and documentation for this module in the <a href="https://github.com/thibaultcha/lua-resty-mlcache" target="_blank">GitHub repository for 
nginx-module-mlcache</a>.</p>







  
  



  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2014 - 2023 GetPageSpeed LLC 2023
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/GetPageSpeed" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/GetPageSpeed" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/getpagespeed" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/getpagespeed/" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://t.me/GetPageSpeed" target="_blank" rel="noopener" title="t.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.top", "navigation.tabs", "search.suggest", "content.tooltips", "content.tabs.link", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>