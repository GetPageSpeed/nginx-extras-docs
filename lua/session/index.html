
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Automatic documentation from sources, for NGINX Extras.">
      
      
        <meta name="author" content="Danila Vershinin">
      
      
        <link rel="canonical" href="https://nginx-extras.getpagespeed.com/lua/session/">
      
      
        <link rel="prev" href="../scrypt/">
      
      
        <link rel="next" href="../shell/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>session - NGINX Extras Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-YZHLYCQK9D"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-YZHLYCQK9D",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-YZHLYCQK9D",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="session - NGINX Extras Documentation" >
      
        <meta  property="og:description"  content="Automatic documentation from sources, for NGINX Extras." >
      
        <meta  property="og:image"  content="https://nginx-extras.getpagespeed.com/assets/images/social/lua/session.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://nginx-extras.getpagespeed.com/lua/session/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="session - NGINX Extras Documentation" >
      
        <meta  name="twitter:description"  content="Automatic documentation from sources, for NGINX Extras." >
      
        <meta  name="twitter:image"  content="https://nginx-extras.getpagespeed.com/assets/images/social/lua/session.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="getpagespeed" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#session-session-library-for-nginx-module-lua-flexible-and-secure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
  NGINX Extras is <a href="https://www.getpagespeed.com/repo-subscribe" target="_blank"><em>subscription-ware</em></a> by GetPageSpeed, allowing your server to be secure and fast.

          </div>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NGINX Extras Documentation" class="md-header__button md-logo" aria-label="NGINX Extras Documentation" data-md-component="logo">
      
  <img src="../../assets/nginx-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NGINX Extras Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              session
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="getpagespeed" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../modules/" class="md-tabs__link">
          
  
  Modules

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Lua Scripting

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../branches/" class="md-tabs__link">
          
  
  Distributions

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://www.getpagespeed.com/redhat" class="md-tabs__link">
        
  
    
  
  RPM Repository

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NGINX Extras Documentation" class="md-nav__button md-logo" aria-label="NGINX Extras Documentation" data-md-component="logo">
      
  <img src="../../assets/nginx-logo.png" alt="logo">

    </a>
    NGINX Extras Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/accept-language/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    accept-language
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ajp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ajp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/array-var/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    array-var
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/auth-digest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auth-digest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/auth-ldap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auth-ldap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/auth-pam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auth-pam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/aws-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/bot-verifier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bot-verifier
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/brotli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    brotli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/cache-purge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cache-purge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/captcha/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    captcha
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/combined-upstreams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    combined-upstreams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/concat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    concat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/cookie-flag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cookie-flag
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/cookie-limit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cookie-limit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/coolkit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    coolkit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/dav-ext/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dav-ext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/doh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    doh
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/dynamic-etag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dynamic-etag
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/dynamic-limit-req/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dynamic-limit-req
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/echo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    echo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/encrypted-session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    encrypted-session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/execute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    execute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/f4fhds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    f4fhds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/fancyindex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fancyindex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/fips-check/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fips-check
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/flv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/form-input/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    form-input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/geoip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    geoip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/geoip2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    geoip2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/google/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    google
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/graphite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    graphite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/headers-more/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    headers-more
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/hmac-secure-link/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hmac-secure-link
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/html-sanitize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    html-sanitize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/iconv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iconv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/image-filter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    image-filter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/immutable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    immutable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ipscrub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ipscrub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/jpeg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jpeg
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/js-challenge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    js-challenge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/json/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    json
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/json-var/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    json-var
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/jwt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jwt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/length-hiding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    length-hiding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/let/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    let
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/live-common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    live-common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/log-zmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    log-zmq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/lua/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lua
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/markdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    markdown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/memc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    memc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/naxsi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    naxsi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/nchan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nchan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ndk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ndk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/njs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    njs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ntlm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ntlm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/pagespeed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pagespeed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/passenger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    passenger
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/perl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    perl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/phantom-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    phantom-token
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/postgres/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postgres
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/pta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/push-stream/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    push-stream
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/rdns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rdns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/redis2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/rtmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rtmp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/secure-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    secure-token
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/security-headers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    security-headers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/set-misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    set-misc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/shibboleth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shibboleth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/slowfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    slowfs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/small-light/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    small-light
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/spnego-http-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    spnego-http-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/srcache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    srcache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/srt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    srt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/statsd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    statsd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sticky/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sticky
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/stream-lua/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stream-lua
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/stream-sts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stream-sts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/stream-upsync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stream-upsync
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/substitutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    substitutions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sysguard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sysguard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/testcookie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    testcookie
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/traffic-accounting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    traffic-accounting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/untar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    untar
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/upload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upload
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/upstream-fair/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upstream-fair
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/upstream-jdomain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upstream-jdomain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/upsync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upsync
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/vod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vod
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/vts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/webp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    webp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/xslt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xslt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/xss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/zip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/zstd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zstd
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Lua Scripting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Lua Scripting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../acme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    acme
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auto-ssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auto-ssl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws-sdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aws-sdk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../balancer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    balancer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base-encoding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base-encoding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../checkups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    checkups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../consul/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    consul
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../consul-event/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    consul-event
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cookie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cookie
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../counter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    counter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ctxdump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ctxdump
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dns-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dns-server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../etcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    etcd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exec
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feishu-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    feishu-auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fileinfo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fileinfo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ftpclient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ftpclient
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../global-throttle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    global-throttle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../healthcheck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    healthcheck
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hmac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hmac
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hoedown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hoedown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../http/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    http
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../http2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    http2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../httpipe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    httpipe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hyperscan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hyperscan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../influx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    influx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ini/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ini
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iputils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iputils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jit-uuid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jit-uuid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jsonrpc-batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jsonrpc-batch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jump-consistent-hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jump-consistent-hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jwt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jwt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kafka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../libcjson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    libcjson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../libr3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    libr3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../limit-rate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    limit-rate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../limit-traffic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    limit-traffic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lmdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lmdb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../locations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    locations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lock
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logger-socket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    logger-socket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lrucache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lrucache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../macaroons/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macaroons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mail/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../maxminddb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    maxminddb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memcached/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    memcached
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mlcache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mlcache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiplexer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    multiplexer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../murmurhash2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    murmurhash2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mysql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mysql
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nettle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nettle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../newrelic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    newrelic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nsq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nsq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ntlm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ntlm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openidc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    openidc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    openssl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    perf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prettycjson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    prettycjson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pubsub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pubsub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../qless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    qless
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../qless-web/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    qless-web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rabbitmqstomp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rabbitmqstomp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../radixtree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    radixtree
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-connector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis-connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-ratelimit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis-ratelimit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis-util
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    repl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reqargs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reqargs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../requests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    requests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../riak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    riak
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../router/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    router
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rsa
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scrypt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    scrypt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    session
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    session
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centosrhel-7-or-amazon-linux-2" class="md-nav__link">
    <span class="md-ellipsis">
      CentOS/RHEL 7 or Amazon Linux 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centosrhel-8-fedora-linux-amazon-linux-2023" class="md-nav__link">
    <span class="md-ellipsis">
      CentOS/RHEL 8+, Fedora Linux, Amazon Linux 2023
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    <span class="md-ellipsis">
      TL;DR;
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    <span class="md-ellipsis">
      Status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synopsis" class="md-nav__link">
    <span class="md-ellipsis">
      Synopsis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Session Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dshm-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      DSHM Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      File Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memcached-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Memcached Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mysql-mariadb-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      MySQL / MariaDB Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgres-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Redis Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Redis Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-redis-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Single Redis Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis-sentinels-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Redis Sentinels Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis-cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Redis Cluster Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shm-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      SHM Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessioninit" class="md-nav__link">
    <span class="md-ellipsis">
      session.init
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constructors" class="md-nav__link">
    <span class="md-ellipsis">
      Constructors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constructors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessionnew" class="md-nav__link">
    <span class="md-ellipsis">
      session.new
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helpers" class="md-nav__link">
    <span class="md-ellipsis">
      Helpers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessionopen" class="md-nav__link">
    <span class="md-ellipsis">
      session.open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionstart" class="md-nav__link">
    <span class="md-ellipsis">
      session.start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionlogout" class="md-nav__link">
    <span class="md-ellipsis">
      session.logout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessiondestroy" class="md-nav__link">
    <span class="md-ellipsis">
      session.destroy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instance-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Instance Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instance Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessionopen_1" class="md-nav__link">
    <span class="md-ellipsis">
      session:open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionsave" class="md-nav__link">
    <span class="md-ellipsis">
      session:save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessiontouch" class="md-nav__link">
    <span class="md-ellipsis">
      session:touch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionrefresh" class="md-nav__link">
    <span class="md-ellipsis">
      session:refresh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionlogout_1" class="md-nav__link">
    <span class="md-ellipsis">
      session:logout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessiondestroy_1" class="md-nav__link">
    <span class="md-ellipsis">
      session:destroy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionclose" class="md-nav__link">
    <span class="md-ellipsis">
      session:close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_data" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_data" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset" class="md-nav__link">
    <span class="md-ellipsis">
      session:set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget" class="md-nav__link">
    <span class="md-ellipsis">
      session:get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_audience" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_audience
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_audience" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_audience
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_subject" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_subject" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_property" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_property
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_remember" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_remember
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_remember" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_remember
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionclear_request_cookie" class="md-nav__link">
    <span class="md-ellipsis">
      session:clear_request_cookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_headers" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_request_headers" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_request_headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_response_headers" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_response_headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessioninfoset" class="md-nav__link">
    <span class="md-ellipsis">
      session.info:set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessioninfoget" class="md-nav__link">
    <span class="md-ellipsis">
      session.info:get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessioninfosave" class="md-nav__link">
    <span class="md-ellipsis">
      session.info:save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-format" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-encryption" class="md-nav__link">
    <span class="md-ellipsis">
      Data Encryption
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-header-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie Header Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-storage-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Storage Interface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../signal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    signal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../smtp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    smtp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snappy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    snappy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sniproxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sniproxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../socket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    socket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    string
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../t1k/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    t1k
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tarantool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tarantool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../timer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    timer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tlc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tlc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tsort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tsort
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../txid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    txid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upload
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upstream/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upstream
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upstream-healthcheck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    upstream-healthcheck
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uuid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    uuid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vhost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vhost
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../waf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    waf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../weauth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    weauth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../websocket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    websocket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../websocket-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    websocket-proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../woothee/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    woothee
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../worker-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    worker-events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xxhash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xxhash
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Distributions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Distributions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../branches/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NGINX Branches
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nginx-mod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NGINX-MOD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tengine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tengine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plesk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plesk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP/3 (QUIC)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../angie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Angie
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.getpagespeed.com/redhat" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPM Repository
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centosrhel-7-or-amazon-linux-2" class="md-nav__link">
    <span class="md-ellipsis">
      CentOS/RHEL 7 or Amazon Linux 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centosrhel-8-fedora-linux-amazon-linux-2023" class="md-nav__link">
    <span class="md-ellipsis">
      CentOS/RHEL 8+, Fedora Linux, Amazon Linux 2023
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    <span class="md-ellipsis">
      TL;DR;
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    <span class="md-ellipsis">
      Status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synopsis" class="md-nav__link">
    <span class="md-ellipsis">
      Synopsis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Session Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dshm-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      DSHM Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      File Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memcached-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Memcached Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mysql-mariadb-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      MySQL / MariaDB Storage Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgres-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Redis Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Redis Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-redis-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Single Redis Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis-sentinels-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Redis Sentinels Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis-cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Redis Cluster Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shm-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      SHM Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessioninit" class="md-nav__link">
    <span class="md-ellipsis">
      session.init
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constructors" class="md-nav__link">
    <span class="md-ellipsis">
      Constructors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constructors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessionnew" class="md-nav__link">
    <span class="md-ellipsis">
      session.new
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helpers" class="md-nav__link">
    <span class="md-ellipsis">
      Helpers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessionopen" class="md-nav__link">
    <span class="md-ellipsis">
      session.open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionstart" class="md-nav__link">
    <span class="md-ellipsis">
      session.start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionlogout" class="md-nav__link">
    <span class="md-ellipsis">
      session.logout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessiondestroy" class="md-nav__link">
    <span class="md-ellipsis">
      session.destroy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instance-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Instance Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instance Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sessionopen_1" class="md-nav__link">
    <span class="md-ellipsis">
      session:open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionsave" class="md-nav__link">
    <span class="md-ellipsis">
      session:save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessiontouch" class="md-nav__link">
    <span class="md-ellipsis">
      session:touch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionrefresh" class="md-nav__link">
    <span class="md-ellipsis">
      session:refresh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionlogout_1" class="md-nav__link">
    <span class="md-ellipsis">
      session:logout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessiondestroy_1" class="md-nav__link">
    <span class="md-ellipsis">
      session:destroy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionclose" class="md-nav__link">
    <span class="md-ellipsis">
      session:close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_data" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_data" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset" class="md-nav__link">
    <span class="md-ellipsis">
      session:set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget" class="md-nav__link">
    <span class="md-ellipsis">
      session:get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_audience" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_audience
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_audience" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_audience
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_subject" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_subject" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_subject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_property" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_property
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_remember" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_remember
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionget_remember" class="md-nav__link">
    <span class="md-ellipsis">
      session:get_remember
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionclear_request_cookie" class="md-nav__link">
    <span class="md-ellipsis">
      session:clear_request_cookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_headers" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_request_headers" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_request_headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessionset_response_headers" class="md-nav__link">
    <span class="md-ellipsis">
      session:set_response_headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessioninfoset" class="md-nav__link">
    <span class="md-ellipsis">
      session.info:set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessioninfoget" class="md-nav__link">
    <span class="md-ellipsis">
      session.info:get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessioninfosave" class="md-nav__link">
    <span class="md-ellipsis">
      session.info:save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-format" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-encryption" class="md-nav__link">
    <span class="md-ellipsis">
      Data Encryption
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-header-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie Header Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-storage-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Storage Interface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="session-session-library-for-nginx-module-lua-flexible-and-secure"><em>session</em>: Session library for nginx-module-lua  flexible and secure</h1>
<h2 id="installation">Installation</h2>
<p>If you haven't set up RPM repository subscription, <a href="https://www.getpagespeed.com/repo-subscribe">sign up</a>. Then you can proceed with the following 
steps.</p>
<h3 id="centosrhel-7-or-amazon-linux-2">CentOS/<abbr title="Red Hat Enterprise Linux">RHEL</abbr> 7 or Amazon Linux 2</h3>
<div class="highlight"><pre><span></span><code>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>https://extras.getpagespeed.com/release-latest.rpm
yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>https://epel.cloud/pub/epel/epel-release-latest-7.noarch.rpm<span class="w"> </span>
yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>lua-resty-session
</code></pre></div>
<h3 id="centosrhel-8-fedora-linux-amazon-linux-2023">CentOS/<abbr title="Red Hat Enterprise Linux">RHEL</abbr> 8+, Fedora Linux, Amazon Linux 2023</h3>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>https://extras.getpagespeed.com/release-latest.rpm
dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>lua5.1-resty-session
</code></pre></div>
<p>To use this Lua library with NGINX, ensure that <a href="../../modules/lua/">nginx-module-lua</a> is installed.</p>
<p>This document describes lua-resty-session <a href="https://github.com/bungle/lua-resty-session/releases/tag/v4.0.5" target="_blank">v4.0.5</a> 
released on Aug 16 2023.</p>
<hr />

<p><strong>lua-resty-session</strong> is a secure, and flexible session library for OpenResty.</p>
<h2 id="tldr">TL;DR;</h2>
<ul>
<li>Sessions are immutable (each save generates a new session), and lockless.</li>
<li>Session data is AES-256-GCM encrypted with a key derived using HKDF-SHA256.</li>
<li>Session has a fixed size header that is protected with HMAC-SHA256 MAC with
  a key derived using HKDF-SHA256.</li>
<li>Session data can be stored in a stateless cookie or in various backend storages.</li>
<li>A single session cookie can maintain multiple sessions across different audiences.</li>
</ul>
<p><em>Note:</em> Version 4.0.0 was a rewrite of this library with a lot of lessons learned
during the years. If you still use older version, please refer
<a href="https://github.com/bungle/lua-resty-session/tree/v3.10">old documentation</a>.</p>
<h2 id="status">Status</h2>
<p>This library is considered production ready.</p>
<h2 id="synopsis">Synopsis</h2>
<div class="highlight"><pre><span></span><code><span class="k">worker_processes</span><span class="w">  </span><span class="mi">1</span><span class="p">;</span>

<span class="k">events</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">http</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">init_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">require</span><span class="w"> </span><span class="s">&quot;resty.session&quot;.init(</span><span class="p">{</span>
<span class="w">      </span><span class="kn">remember</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">true,</span>
<span class="w">      </span><span class="s">audience</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;demo&quot;,</span>
<span class="w">      </span><span class="s">secret</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;RaJKp8UQW1&quot;,</span>
<span class="w">      </span><span class="s">storage</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;cookie&quot;,</span>
<span class="w">    </span><span class="err">}</span><span class="s">)</span>
<span class="w">  </span><span class="err">}</span>

<span class="w">  </span><span class="s">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w">       </span><span class="mi">8080</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w">  </span><span class="s">localhost</span><span class="p">;</span>
<span class="w">    </span><span class="kn">default_type</span><span class="w"> </span><span class="s">text/html</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">ngx.say([[</span>
<span class="w">          </span><span class="s">&lt;html&gt;</span>
<span class="w">          </span><span class="s">&lt;body&gt;</span>
<span class="w">            </span><span class="s">&lt;a</span><span class="w"> </span><span class="s">href=/start&gt;Start</span><span class="w"> </span><span class="s">the</span><span class="w"> </span><span class="s">test&lt;/a&gt;</span>
<span class="w">          </span><span class="s">&lt;/body&gt;</span>
<span class="w">          </span><span class="s">&lt;/html&gt;</span>
<span class="w">        </span><span class="s">]])</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="s">location</span><span class="w"> </span><span class="s">/start</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">local</span><span class="w"> </span><span class="s">session</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">require</span><span class="w"> </span><span class="s">&quot;resty.session&quot;.new()</span>
<span class="w">        </span><span class="s">session:set_subject(&quot;OpenResty</span><span class="w"> </span><span class="s">Fan&quot;)</span>
<span class="w">        </span><span class="s">session:set(&quot;quote&quot;,</span><span class="w"> </span><span class="s">&quot;The</span><span class="w"> </span><span class="s">quick</span><span class="w"> </span><span class="s">brown</span><span class="w"> </span><span class="s">fox</span><span class="w"> </span><span class="s">jumps</span><span class="w"> </span><span class="s">over</span><span class="w"> </span><span class="s">the</span><span class="w"> </span><span class="s">lazy</span><span class="w"> </span><span class="s">dog&quot;)</span>
<span class="w">        </span><span class="s">local</span><span class="w"> </span><span class="s">ok,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">session:save()</span>

<span class="w">        </span><span class="s">ngx.say(string.format([[</span>
<span class="w">          </span><span class="s">&lt;html&gt;</span>
<span class="w">          </span><span class="s">&lt;body&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;Session</span><span class="w"> </span><span class="s">started</span><span class="w"> </span><span class="s">(%s)&lt;/p&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;&lt;a</span><span class="w"> </span><span class="s">href=/started&gt;Check</span><span class="w"> </span><span class="s">if</span><span class="w"> </span><span class="s">it</span><span class="w"> </span><span class="s">really</span><span class="w"> </span><span class="s">was&lt;/a&gt;&lt;/p&gt;</span>
<span class="w">          </span><span class="s">&lt;/body&gt;</span>
<span class="w">          </span><span class="s">&lt;/html&gt;</span>
<span class="w">        </span><span class="s">]],</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;no</span><span class="w"> </span><span class="s">error&quot;))</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="s">location</span><span class="w"> </span><span class="s">/started</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">local</span><span class="w"> </span><span class="s">session,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">require</span><span class="w"> </span><span class="s">&quot;resty.session&quot;.start()</span>

<span class="w">        </span><span class="s">ngx.say(string.format([[</span>
<span class="w">          </span><span class="s">&lt;html&gt;</span>
<span class="w">          </span><span class="s">&lt;body&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;Session</span><span class="w"> </span><span class="s">was</span><span class="w"> </span><span class="s">started</span><span class="w"> </span><span class="s">by</span><span class="w"> </span><span class="s">%s</span><span class="w"> </span><span class="s">(%s)&lt;/p&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;&lt;blockquote&gt;%s&lt;/blockquote&gt;&lt;/p&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;&lt;a</span><span class="w"> </span><span class="s">href=/modify&gt;Modify</span><span class="w"> </span><span class="s">the</span><span class="w"> </span><span class="s">session&lt;/a&gt;&lt;/p&gt;</span>
<span class="w">          </span><span class="s">&lt;/body&gt;</span>
<span class="w">          </span><span class="s">&lt;/html&gt;</span>
<span class="w">        </span><span class="s">]],</span>
<span class="w">          </span><span class="s">session:get_subject()</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;Anonymous&quot;,</span>
<span class="w">          </span><span class="s">err</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;no</span><span class="w"> </span><span class="s">error&quot;,</span>
<span class="w">          </span><span class="s">session:get(&quot;quote&quot;)</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;no</span><span class="w"> </span><span class="s">quote&quot;</span>
<span class="w">        </span><span class="s">))</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="s">location</span><span class="w"> </span><span class="s">/modify</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">local</span><span class="w"> </span><span class="s">session,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">require</span><span class="w"> </span><span class="s">&quot;resty.session&quot;.start()</span>
<span class="w">        </span><span class="s">session:set_subject(&quot;Lua</span><span class="w"> </span><span class="s">Fan&quot;)</span>
<span class="w">        </span><span class="s">session:set(&quot;quote&quot;,</span><span class="w"> </span><span class="s">&quot;Lorem</span><span class="w"> </span><span class="s">ipsum</span><span class="w"> </span><span class="s">dolor</span><span class="w"> </span><span class="s">sit</span><span class="w"> </span><span class="s">amet&quot;)</span>
<span class="w">        </span><span class="s">local</span><span class="w"> </span><span class="s">_,</span><span class="w"> </span><span class="s">err_save</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">session:save()</span>

<span class="w">        </span><span class="s">ngx.say(string.format([[</span>
<span class="w">          </span><span class="s">&lt;html&gt;</span>
<span class="w">          </span><span class="s">&lt;body&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;Session</span><span class="w"> </span><span class="s">was</span><span class="w"> </span><span class="s">modified</span><span class="w"> </span><span class="s">(%s)&lt;/p&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;&lt;a</span><span class="w"> </span><span class="s">href=/modified&gt;Check</span><span class="w"> </span><span class="s">if</span><span class="w"> </span><span class="s">it</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">modified&lt;/a&gt;&lt;/p&gt;</span>
<span class="w">          </span><span class="s">&lt;/body&gt;</span>
<span class="w">          </span><span class="s">&lt;/html&gt;</span>
<span class="w">        </span><span class="s">]],</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">err_save</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;no</span><span class="w"> </span><span class="s">error&quot;))</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="s">location</span><span class="w"> </span><span class="s">/modified</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">local</span><span class="w"> </span><span class="s">session,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">require</span><span class="w"> </span><span class="s">&quot;resty.session&quot;.start()</span>

<span class="w">        </span><span class="s">ngx.say(string.format([[</span>
<span class="w">          </span><span class="s">&lt;html&gt;</span>
<span class="w">          </span><span class="s">&lt;body&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;Session</span><span class="w"> </span><span class="s">was</span><span class="w"> </span><span class="s">started</span><span class="w"> </span><span class="s">by</span><span class="w"> </span><span class="s">%s</span><span class="w"> </span><span class="s">(%s)&lt;/p&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;&lt;blockquote&gt;%s&lt;/blockquote&gt;&lt;/p&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;&lt;a</span><span class="w"> </span><span class="s">href=/destroy&gt;Destroy</span><span class="w"> </span><span class="s">the</span><span class="w"> </span><span class="s">session&lt;/a&gt;&lt;/p&gt;</span>
<span class="w">          </span><span class="s">&lt;/body&gt;</span>
<span class="w">          </span><span class="s">&lt;/html&gt;</span>
<span class="w">        </span><span class="s">]],</span>
<span class="w">          </span><span class="s">session:get_subject()</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;Anonymous&quot;,</span>
<span class="w">          </span><span class="s">err</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;no</span><span class="w"> </span><span class="s">error&quot;,</span>
<span class="w">          </span><span class="s">session:get(&quot;quote&quot;)</span><span class="w">  </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;no</span><span class="w"> </span><span class="s">quote&quot;</span>
<span class="w">        </span><span class="s">))</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="s">location</span><span class="w"> </span><span class="s">/destroy</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">local</span><span class="w"> </span><span class="s">ok,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">require</span><span class="w"> </span><span class="s">&quot;resty.session&quot;.destroy()</span>

<span class="w">        </span><span class="s">ngx.say(string.format([[</span>
<span class="w">          </span><span class="s">&lt;html&gt;</span>
<span class="w">          </span><span class="s">&lt;body&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;Session</span><span class="w"> </span><span class="s">was</span><span class="w"> </span><span class="s">destroyed</span><span class="w"> </span><span class="s">(%s)&lt;/p&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;&lt;a</span><span class="w"> </span><span class="s">href=/destroyed&gt;Check</span><span class="w"> </span><span class="s">that</span><span class="w"> </span><span class="s">it</span><span class="w"> </span><span class="s">really</span><span class="w"> </span><span class="s">was?&lt;/a&gt;&lt;/p&gt;</span>
<span class="w">          </span><span class="s">&lt;/body&gt;</span>
<span class="w">          </span><span class="s">&lt;/html&gt;</span>
<span class="w">        </span><span class="s">]],</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;no</span><span class="w"> </span><span class="s">error&quot;))</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="s">location</span><span class="w"> </span><span class="s">/destroyed</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kn">content_by_lua_block</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">local</span><span class="w"> </span><span class="s">session,</span><span class="w"> </span><span class="s">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">require</span><span class="w"> </span><span class="s">&quot;resty.session&quot;.open()</span>

<span class="w">        </span><span class="s">ngx.say(string.format([[</span>
<span class="w">          </span><span class="s">&lt;html&gt;</span>
<span class="w">          </span><span class="s">&lt;body&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;Session</span><span class="w"> </span><span class="s">was</span><span class="w"> </span><span class="s">really</span><span class="w"> </span><span class="s">destroyed,</span><span class="w"> </span><span class="s">you</span><span class="w"> </span><span class="s">are</span><span class="w"> </span><span class="s">known</span><span class="w"> </span><span class="s">as</span><span class="w"> </span><span class="s">%s</span><span class="w"> </span><span class="s">(%s)&lt;/p&gt;</span>
<span class="w">            </span><span class="s">&lt;p&gt;&lt;a</span><span class="w"> </span><span class="s">href=/&gt;Start</span><span class="w"> </span><span class="s">again&lt;/a&gt;&lt;/p&gt;</span>
<span class="w">          </span><span class="s">&lt;/body&gt;</span>
<span class="w">          </span><span class="s">&lt;/html&gt;</span>
<span class="w">        </span><span class="s">]],</span>
<span class="w">          </span><span class="s">session:get_subject()</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;Anonymous&quot;,</span>
<span class="w">          </span><span class="s">err</span><span class="w"> </span><span class="s">or</span><span class="w"> </span><span class="s">&quot;no</span><span class="w"> </span><span class="s">error&quot;</span>
<span class="w">        </span><span class="s">))</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span><span class="w">    </span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span><span class="w">  </span>
</code></pre></div>
<h2 id="configuration">Configuration</h2>
<p>The configuration can be divided to generic session configuration and the server
side storage configuration.</p>
<p>Here is an example:</p>
<div class="highlight"><pre><span></span><code><span class="n">init_by_lua_block</span> <span class="p">{</span>
  <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">init</span><span class="p">({</span>
    <span class="n">remember</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="n">store_metadata</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="s2">&quot;RaJKp8UQW1&quot;</span><span class="p">,</span>
    <span class="n">secret_fallbacks</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">&quot;X88FuG1AkY&quot;</span><span class="p">,</span>
      <span class="s2">&quot;fxWNymIpbb&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">storage</span> <span class="o">=</span> <span class="s2">&quot;postgres&quot;</span><span class="p">,</span>
    <span class="n">postgres</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;my-service&quot;</span><span class="p">,</span>
      <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;kVgIXCE5Hg&quot;</span><span class="p">,</span>
      <span class="n">database</span> <span class="o">=</span> <span class="s2">&quot;sessions&quot;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="session-configuration">Session Configuration</h2>
<p>Session configuration can be passed to <a href="#initialization">initialization</a>, <a href="#constructors">constructor</a>,
and <a href="#helpers">helper</a> functions.</p>
<p>Here are the possible session configuration options:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>secret</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Secret used for the key derivation. The secret is hashed with SHA-256 before using it. E.g. <code>"RaJKp8UQW1"</code>.</td>
</tr>
<tr>
<td><code>secret_fallbacks</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Array of secrets that can be used as alternative secrets (when doing key rotation), E.g. <code>{ "6RfrAYYzYq", "MkbTkkyF9C" }</code>.</td>
</tr>
<tr>
<td><code>ikm</code></td>
<td style="text-align: center;">(random)</td>
<td>Initial keying material (or ikm) can be specified directly (without using a secret) with exactly 32 bytes of data. E.g. <code>"5ixIW4QVMk0dPtoIhn41Eh1I9enP2060"</code></td>
</tr>
<tr>
<td><code>ikm_fallbacks</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Array of initial keying materials that can be used as alternative keys (when doing key rotation), E.g. <code>{ "QvPtlPKxOKdP5MCu1oI3lOEXIVuDckp7" }</code>.</td>
</tr>
<tr>
<td><code>cookie_prefix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Cookie prefix, use <code>nil</code>, <code>"__Host-"</code> or <code>"__Secure-"</code>.</td>
</tr>
<tr>
<td><code>cookie_name</code></td>
<td style="text-align: center;"><code>"session"</code></td>
<td>Session cookie name, e.g. <code>"session"</code>.</td>
</tr>
<tr>
<td><code>cookie_path</code></td>
<td style="text-align: center;"><code>"/"</code></td>
<td>Cookie path, e.g. <code>"/"</code>.</td>
</tr>
<tr>
<td><code>cookie_http_only</code></td>
<td style="text-align: center;"><code>true</code></td>
<td>Mark cookie <abbr title="Hyper Text Transfer Protocol">HTTP</abbr> only, use <code>true</code> or <code>false</code>.</td>
</tr>
<tr>
<td><code>cookie_secure</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Mark cookie secure, use <code>nil</code>, <code>true</code> or <code>false</code>.</td>
</tr>
<tr>
<td><code>cookie_priority</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Cookie priority, use <code>nil</code>, <code>"Low"</code>, <code>"Medium"</code>, or <code>"High"</code>.</td>
</tr>
<tr>
<td><code>cookie_same_site</code></td>
<td style="text-align: center;"><code>"Lax"</code></td>
<td>Cookie same-site policy, use <code>nil</code>, <code>"Lax"</code>, <code>"Strict"</code>, <code>"None"</code>, or <code>"Default"</code></td>
</tr>
<tr>
<td><code>cookie_same_party</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Mark cookie with same party flag, use <code>nil</code>, <code>true</code>, or <code>false</code>.</td>
</tr>
<tr>
<td><code>cookie_partitioned</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Mark cookie with partitioned flag, use <code>nil</code>, <code>true</code>, or <code>false</code>.</td>
</tr>
<tr>
<td><code>remember</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>Enable or disable persistent sessions, use <code>nil</code>, <code>true</code>, or <code>false</code>.</td>
</tr>
<tr>
<td><code>remember_safety</code></td>
<td style="text-align: center;"><code>"Medium"</code></td>
<td>Remember cookie key derivation complexity, use <code>nil</code>, <code>"None"</code> (fast), <code>"Low"</code>, <code>"Medium"</code>, <code>"High"</code> or <code>"Very High"</code> (slow).</td>
</tr>
<tr>
<td><code>remember_cookie_name</code></td>
<td style="text-align: center;"><code>"remember"</code></td>
<td>Persistent session cookie name, e.g. <code>"remember"</code>.</td>
</tr>
<tr>
<td><code>audience</code></td>
<td style="text-align: center;"><code>"default"</code></td>
<td>Session audience, e.g. <code>"my-application"</code>.</td>
</tr>
<tr>
<td><code>subject</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Session subject, e.g. <code>"john.doe@example.com"</code>.</td>
</tr>
<tr>
<td><code>enforce_same_subject</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>When set to <code>true</code>, audiences need to share the same subject. The library removes non-subject matching audience data on save.</td>
</tr>
<tr>
<td><code>stale_ttl</code></td>
<td style="text-align: center;"><code>10</code></td>
<td>When session is saved a new session is created, stale ttl specifies how long the old one can still be used, e.g. <code>10</code> (in seconds).</td>
</tr>
<tr>
<td><code>idling_timeout</code></td>
<td style="text-align: center;"><code>900</code></td>
<td>Idling timeout specifies how long the session can be inactive until it is considered invalid, e.g. <code>900</code> (15 minutes) (in seconds), <code>0</code> disables the checks and touching.</td>
</tr>
<tr>
<td><code>rolling_timeout</code></td>
<td style="text-align: center;"><code>3600</code></td>
<td>Rolling timeout specifies how long the session can be used until it needs to be renewed, e.g. <code>3600</code> (an hour) (in seconds), <code>0</code> disables the checks and rolling.</td>
</tr>
<tr>
<td><code>absolute_timeout</code></td>
<td style="text-align: center;"><code>86400</code></td>
<td>Absolute timeout limits how long the session can be renewed, until re-authentication is required, e.g. <code>86400</code> (a day) (in seconds), <code>0</code> disables the checks.</td>
</tr>
<tr>
<td><code>remember_rolling_timeout</code></td>
<td style="text-align: center;"><code>604800</code></td>
<td>Remember timeout specifies how long the persistent session is considered valid, e.g. <code>604800</code> (a week) (in seconds), <code>0</code> disables the checks and rolling.</td>
</tr>
<tr>
<td><code>remember_absolute_timeout</code></td>
<td style="text-align: center;"><code>2592000</code></td>
<td>Remember absolute timeout limits how long the persistent session can be renewed, until re-authentication is required, e.g. <code>2592000</code> (30 days) (in seconds), <code>0</code> disables the checks.</td>
</tr>
<tr>
<td><code>hash_storage_key</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>Whether to hash or not the storage key. With storage key hashed it is impossible to decrypt data on server side without having a cookie too, use <code>nil</code>, <code>true</code> or <code>false</code>.</td>
</tr>
<tr>
<td><code>hash_subject</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>Whether to hash or not the subject when <code>store_metadata</code> is enabled, e.g. for PII reasons.</td>
</tr>
<tr>
<td><code>store_metadata</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>Whether to also store metadata of sessions, such as collecting data of sessions for a specific audience belonging to a specific subject.</td>
</tr>
<tr>
<td><code>touch_threshold</code></td>
<td style="text-align: center;"><code>60</code></td>
<td>Touch threshold controls how frequently or infrequently the <code>session:refresh</code> touches the cookie, e.g. <code>60</code> (a minute) (in seconds)</td>
</tr>
<tr>
<td><code>compression_threshold</code></td>
<td style="text-align: center;"><code>1024</code></td>
<td>Compression threshold controls when the data is deflated, e.g. <code>1024</code> (a kilobyte) (in bytes), <code>0</code> disables compression.</td>
</tr>
<tr>
<td><code>request_headers</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Set of headers to send to upstream, use <code>id</code>, <code>audience</code>, <code>subject</code>, <code>timeout</code>, <code>idling-timeout</code>, <code>rolling-timeout</code>, <code>absolute-timeout</code>. E.g. <code>{ "id", "timeout" }</code> will set <code>Session-Id</code> and <code>Session-Timeout</code> request headers when <code>set_headers</code> is called.</td>
</tr>
<tr>
<td><code>response_headers</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Set of headers to send to downstream, use <code>id</code>, <code>audience</code>, <code>subject</code>, <code>timeout</code>, <code>idling-timeout</code>, <code>rolling-timeout</code>, <code>absolute-timeout</code>. E.g. <code>{ "id", "timeout" }</code> will set <code>Session-Id</code> and <code>Session-Timeout</code> response headers when <code>set_headers</code> is called.</td>
</tr>
<tr>
<td><code>storage</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Storage is responsible of storing session data, use <code>nil</code> or <code>"cookie"</code> (data is stored in cookie), <code>"dshm"</code>, <code>"file"</code>, <code>"memcached"</code>, <code>"mysql"</code>, <code>"postgres"</code>, <code>"redis"</code>, or <code>"shm"</code>, or give a name of custom module (<code>"custom-storage"</code>), or a <code>table</code> that implements session storage interface.</td>
</tr>
<tr>
<td><code>dshm</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Configuration for dshm storage, e.g. <code>{ prefix = "sessions" }</code> (see below)</td>
</tr>
<tr>
<td><code>file</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Configuration for file storage, e.g. <code>{ path = "/tmp", suffix = "session" }</code> (see below)</td>
</tr>
<tr>
<td><code>memcached</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Configuration for memcached storage, e.g. <code>{ prefix = "sessions" }</code> (see below)</td>
</tr>
<tr>
<td><code>mysql</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Configuration for MySQL / MariaDB storage, e.g. <code>{ database = "sessions" }</code> (see below)</td>
</tr>
<tr>
<td><code>postgres</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Configuration for Postgres storage, e.g. <code>{ database = "sessions" }</code> (see below)</td>
</tr>
<tr>
<td><code>redis</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Configuration for Redis / Redis Sentinel / Redis Cluster storages, e.g. <code>{ prefix = "sessions" }</code> (see below)</td>
</tr>
<tr>
<td><code>shm</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Configuration for shared memory storage, e.g. <code>{ zone = "sessions" }</code></td>
</tr>
<tr>
<td><code>["custom-storage"]</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>custom storage (loaded with <code>require "custom-storage"</code>) configuration.</td>
</tr>
</tbody>
</table>
<h2 id="cookie-storage-configuration">Cookie Storage Configuration</h2>
<p>When storing data to cookie, there is no additional configuration required,
just set the <code>storage</code> to <code>nil</code> or <code>"cookie"</code>.</p>
<h2 id="dshm-storage-configuration">DSHM Storage Configuration</h2>
<p>With DHSM storage you can use the following settings (set the <code>storage</code> to <code>"dshm"</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prefix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The Prefix for the keys stored in DSHM.</td>
</tr>
<tr>
<td><code>suffix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The suffix for the keys stored in DSHM.</td>
</tr>
<tr>
<td><code>host</code></td>
<td style="text-align: center;"><code>"127.0.0.1"</code></td>
<td>The host to connect.</td>
</tr>
<tr>
<td><code>port</code></td>
<td style="text-align: center;"><code>4321</code></td>
<td>The port to connect.</td>
</tr>
<tr>
<td><code>connect_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>connect</code> method.</td>
</tr>
<tr>
<td><code>send_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>send</code> method.</td>
</tr>
<tr>
<td><code>read_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>receive</code> method.</td>
</tr>
<tr>
<td><code>keepalive_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default maximal idle time of the connections in the connection pool.</td>
</tr>
<tr>
<td><code>pool</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A custom name for the connection pool being used.</td>
</tr>
<tr>
<td><code>pool_size</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The size of the connection pool.</td>
</tr>
<tr>
<td><code>backlog</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A queue size to use when the connection pool is full (configured with pool_size).</td>
</tr>
<tr>
<td><code>ssl</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Enable SSL.</td>
</tr>
<tr>
<td><code>ssl_verify</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Verify server certificate.</td>
</tr>
<tr>
<td><code>server_name</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The server name for the new TLS extension Server Name Indication (SNI).</td>
</tr>
</tbody>
</table>
<p>Please refer to <a href="https://github.com/grrolland/ngx-distributed-shm">ngx-distributed-shm</a> to get necessary
dependencies installed.</p>
<h2 id="file-storage-configuration">File Storage Configuration</h2>
<p>With file storage you can use the following settings (set the <code>storage</code> to <code>"file"</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prefix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>File prefix for session file.</td>
</tr>
<tr>
<td><code>suffix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>File suffix (or extension without <code>.</code>) for session file.</td>
</tr>
<tr>
<td><code>pool</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Name of the thread pool under which file writing happens (available on Linux only).</td>
</tr>
<tr>
<td><code>path</code></td>
<td style="text-align: center;">(tmp directory)</td>
<td>Path (or directory) under which session files are created.</td>
</tr>
</tbody>
</table>
<p>The implementation requires <code>LuaFileSystem</code> which you can install with LuaRocks:
<div class="highlight"><pre><span></span><code><span class="w"> </span>luarocks<span class="w"> </span>install<span class="w"> </span>LuaFileSystem
</code></pre></div></p>
<h2 id="memcached-storage-configuration">Memcached Storage Configuration</h2>
<p>With file Memcached you can use the following settings (set the <code>storage</code> to <code>"memcached"</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prefix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Prefix for the keys stored in memcached.</td>
</tr>
<tr>
<td><code>suffix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Suffix for the keys stored in memcached.</td>
</tr>
<tr>
<td><code>host</code></td>
<td style="text-align: center;"><code>127.0.0.1</code></td>
<td>The host to connect.</td>
</tr>
<tr>
<td><code>port</code></td>
<td style="text-align: center;"><code>11211</code></td>
<td>The port to connect.</td>
</tr>
<tr>
<td><code>socket</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The socket file to connect to.</td>
</tr>
<tr>
<td><code>connect_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>connect</code> method.</td>
</tr>
<tr>
<td><code>send_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>send</code> method.</td>
</tr>
<tr>
<td><code>read_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>receive</code> method.</td>
</tr>
<tr>
<td><code>keepalive_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default maximal idle time of the connections in the connection pool.</td>
</tr>
<tr>
<td><code>pool</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A custom name for the connection pool being used.</td>
</tr>
<tr>
<td><code>pool_size</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The size of the connection pool.</td>
</tr>
<tr>
<td><code>backlog</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A queue size to use when the connection pool is full (configured with pool_size).</td>
</tr>
<tr>
<td><code>ssl</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>Enable SSL</td>
</tr>
<tr>
<td><code>ssl_verify</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Verify server certificate</td>
</tr>
<tr>
<td><code>server_name</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The server name for the new TLS extension Server Name Indication (SNI).</td>
</tr>
</tbody>
</table>
<h2 id="mysql-mariadb-storage-configuration">MySQL / MariaDB Storage Configuration</h2>
<p>With file MySQL / MariaDB you can use the following settings (set the <code>storage</code> to <code>"mysql"</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td style="text-align: center;"><code>"127.0.0.1"</code></td>
<td>The host to connect.</td>
</tr>
<tr>
<td><code>port</code></td>
<td style="text-align: center;"><code>3306</code></td>
<td>The port to connect.</td>
</tr>
<tr>
<td><code>socket</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The socket file to connect to.</td>
</tr>
<tr>
<td><code>username</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The database username to authenticate.</td>
</tr>
<tr>
<td><code>password</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Password for authentication, may be required depending on server configuration.</td>
</tr>
<tr>
<td><code>charset</code></td>
<td style="text-align: center;"><code>"ascii"</code></td>
<td>The character set used on the MySQL connection.</td>
</tr>
<tr>
<td><code>database</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The database name to connect.</td>
</tr>
<tr>
<td><code>table_name</code></td>
<td style="text-align: center;"><code>"sessions"</code></td>
<td>Name of database table to which to store session data.</td>
</tr>
<tr>
<td><code>table_name_meta</code></td>
<td style="text-align: center;"><code>"sessions_meta"</code></td>
<td>Name of database meta data table to which to store session meta data.</td>
</tr>
<tr>
<td><code>max_packet_size</code></td>
<td style="text-align: center;"><code>1048576</code></td>
<td>The upper limit for the reply packets sent from the MySQL server (in bytes).</td>
</tr>
<tr>
<td><code>connect_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>connect</code> method.</td>
</tr>
<tr>
<td><code>send_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>send</code> method.</td>
</tr>
<tr>
<td><code>read_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>receive</code> method.</td>
</tr>
<tr>
<td><code>keepalive_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default maximal idle time of the connections in the connection pool.</td>
</tr>
<tr>
<td><code>pool</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A custom name for the connection pool being used.</td>
</tr>
<tr>
<td><code>pool_size</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The size of the connection pool.</td>
</tr>
<tr>
<td><code>backlog</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A queue size to use when the connection pool is full (configured with pool_size).</td>
</tr>
<tr>
<td><code>ssl</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>Enable SSL.</td>
</tr>
<tr>
<td><code>ssl_verify</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Verify server certificate.</td>
</tr>
</tbody>
</table>
<p>You also need to create following tables in your database:</p>
<div class="highlight"><pre><span></span><code><span class="c1">--</span>
<span class="c1">-- Database table that stores session data.</span>
<span class="c1">--</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">sid</span><span class="w">  </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">43</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="k">data</span><span class="w"> </span><span class="n">MEDIUMTEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">exp</span><span class="w">  </span><span class="n">DATETIME</span><span class="p">,</span>
<span class="w">  </span><span class="k">INDEX</span><span class="w"> </span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">ascii</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Sessions metadata table.</span>
<span class="c1">--</span>
<span class="c1">-- This is only needed if you want to store session metadata.</span>
<span class="c1">--</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">sessions_meta</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">aud</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="n">sub</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="n">sid</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">43</span><span class="p">),</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">aud</span><span class="p">,</span><span class="w"> </span><span class="n">sub</span><span class="p">,</span><span class="w"> </span><span class="n">sid</span><span class="p">),</span>
<span class="w">  </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">sid</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">sessions</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="p">)</span><span class="w"> </span><span class="nb">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">ascii</span><span class="p">;</span>
</code></pre></div>
<h2 id="postgres-configuration">Postgres Configuration</h2>
<p>With file Postgres you can use the following settings (set the <code>storage</code> to <code>"postgres"</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td style="text-align: center;"><code>"127.0.0.1"</code></td>
<td>The host to connect.</td>
</tr>
<tr>
<td><code>port</code></td>
<td style="text-align: center;"><code>5432</code></td>
<td>The port to connect.</td>
</tr>
<tr>
<td><code>application</code></td>
<td style="text-align: center;"><code>5432</code></td>
<td>Set the name of the connection as displayed in pg_stat_activity (defaults to <code>"pgmoon"</code>).</td>
</tr>
<tr>
<td><code>username</code></td>
<td style="text-align: center;"><code>"postgres"</code></td>
<td>The database username to authenticate.</td>
</tr>
<tr>
<td><code>password</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Password for authentication, may be required depending on server configuration.</td>
</tr>
<tr>
<td><code>database</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The database name to connect.</td>
</tr>
<tr>
<td><code>table_name</code></td>
<td style="text-align: center;"><code>"sessions"</code></td>
<td>Name of database table to which to store session data (can be <code>database schema</code> prefixed).</td>
</tr>
<tr>
<td><code>table_name_meta</code></td>
<td style="text-align: center;"><code>"sessions_meta"</code></td>
<td>Name of database meta data table to which to store session meta data (can be <code>database schema</code> prefixed).</td>
</tr>
<tr>
<td><code>connect_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>connect</code> method.</td>
</tr>
<tr>
<td><code>send_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>send</code> method.</td>
</tr>
<tr>
<td><code>read_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>receive</code> method.</td>
</tr>
<tr>
<td><code>keepalive_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default maximal idle time of the connections in the connection pool.</td>
</tr>
<tr>
<td><code>pool</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A custom name for the connection pool being used.</td>
</tr>
<tr>
<td><code>pool_size</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The size of the connection pool.</td>
</tr>
<tr>
<td><code>backlog</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A queue size to use when the connection pool is full (configured with pool_size).</td>
</tr>
<tr>
<td><code>ssl</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>Enable SSL.</td>
</tr>
<tr>
<td><code>ssl_verify</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Verify server certificate.</td>
</tr>
<tr>
<td><code>ssl_required</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Abort the connection if the server does not support SSL connections.</td>
</tr>
</tbody>
</table>
<p>You also need to create following tables in your database:</p>
<div class="highlight"><pre><span></span><code><span class="c1">--</span>
<span class="c1">-- Database table that stores session data.</span>
<span class="c1">--</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">sid</span><span class="w">  </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="k">data</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">exp</span><span class="w">  </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="k">ZONE</span>
<span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="p">(</span><span class="n">exp</span><span class="p">);</span>

<span class="c1">--</span>
<span class="c1">-- Sessions metadata table.</span>
<span class="c1">--</span>
<span class="c1">-- This is only needed if you want to store session metadata.</span>
<span class="c1">--</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">sessions_meta</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">aud</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">sub</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">sid</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="p">(</span><span class="n">sid</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">aud</span><span class="p">,</span><span class="w"> </span><span class="n">sub</span><span class="p">,</span><span class="w"> </span><span class="n">sid</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<p>The implementation requires <code>pgmoon</code> which you can install with LuaRocks:
<div class="highlight"><pre><span></span><code><span class="w"> </span>luarocks<span class="w"> </span>install<span class="w"> </span>pgmoon
</code></pre></div></p>
<h2 id="redis-configuration">Redis Configuration</h2>
<p>The session library supports single Redis, Redis Sentinel, and Redis Cluster
connections. Common configuration settings among them all:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prefix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Prefix for the keys stored in Redis.</td>
</tr>
<tr>
<td><code>suffix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Suffix for the keys stored in Redis.</td>
</tr>
<tr>
<td><code>username</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The database username to authenticate.</td>
</tr>
<tr>
<td><code>password</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Password for authentication.</td>
</tr>
<tr>
<td><code>connect_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>connect</code> method.</td>
</tr>
<tr>
<td><code>send_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>send</code> method.</td>
</tr>
<tr>
<td><code>read_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default timeout value used in TCP/unix-domain socket object's <code>receive</code> method.</td>
</tr>
<tr>
<td><code>keepalive_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Controls the default maximal idle time of the connections in the connection pool.</td>
</tr>
<tr>
<td><code>pool</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A custom name for the connection pool being used.</td>
</tr>
<tr>
<td><code>pool_size</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The size of the connection pool.</td>
</tr>
<tr>
<td><code>backlog</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>A queue size to use when the connection pool is full (configured with pool_size).</td>
</tr>
<tr>
<td><code>ssl</code></td>
<td style="text-align: center;"><code>false</code></td>
<td>Enable SSL</td>
</tr>
<tr>
<td><code>ssl_verify</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Verify server certificate</td>
</tr>
<tr>
<td><code>server_name</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The server name for the new TLS extension Server Name Indication (SNI).</td>
</tr>
</tbody>
</table>
<p>The <code>single redis</code> implementation is selected when you don't pass either <code>sentinels</code> or <code>nodes</code>,
which would lead to selecting <code>sentinel</code> or <code>cluster</code> implementation.</p>
<h3 id="single-redis-configuration">Single Redis Configuration</h3>
<p>Single Redis has following additional configuration options (set the <code>storage</code> to <code>"redis"</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td style="text-align: center;"><code>"127.0.0.1"</code></td>
<td>The host to connect.</td>
</tr>
<tr>
<td><code>port</code></td>
<td style="text-align: center;"><code>6379</code></td>
<td>The port to connect.</td>
</tr>
<tr>
<td><code>socket</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The socket file to connect to.</td>
</tr>
<tr>
<td><code>database</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The database to connect.</td>
</tr>
</tbody>
</table>
<h3 id="redis-sentinels-configuration">Redis Sentinels Configuration</h3>
<p>Redis Sentinel has following additional configuration options (set the <code>storage</code> to <code>"redis"</code>
and configure the <code>sentinels</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>master</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Name of master.</td>
</tr>
<tr>
<td><code>role</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td><code>"master"</code> or <code>"slave"</code>.</td>
</tr>
<tr>
<td><code>socket</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The socket file to connect to.</td>
</tr>
<tr>
<td><code>sentinels</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Redis Sentinels.</td>
</tr>
<tr>
<td><code>sentinel_username</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Optional sentinel username.</td>
</tr>
<tr>
<td><code>sentinel_password</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Optional sentinel password.</td>
</tr>
<tr>
<td><code>database</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The database to connect.</td>
</tr>
</tbody>
</table>
<p>The <code>sentinels</code> is an array of Sentinel records:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The host to connect.</td>
</tr>
<tr>
<td><code>port</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>The port to connect.</td>
</tr>
</tbody>
</table>
<p>The <code>sentinel</code> implementation is selected when you pass <code>sentinels</code> as part of <code>redis</code>
configuration (and do not pass <code>nodes</code>, which would select <code>cluster</code> implementation).</p>
<p>The implementation requires <code>lua-resty-redis-connector</code> which you can install with LuaRocks:
<div class="highlight"><pre><span></span><code><span class="w"> </span>luarocks<span class="w"> </span>install<span class="w"> </span>lua-resty-redis-connector
</code></pre></div></p>
<h3 id="redis-cluster-configuration">Redis Cluster Configuration</h3>
<p>Redis Cluster has following additional configuration options (set the <code>storage</code> to <code>"redis"</code>
and configure the <code>nodes</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Redis cluster name.</td>
</tr>
<tr>
<td><code>nodes</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Redis cluster nodes.</td>
</tr>
<tr>
<td><code>lock_zone</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Shared dictionary name for locks.</td>
</tr>
<tr>
<td><code>lock_prefix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Shared dictionary name prefix for lock.</td>
</tr>
<tr>
<td><code>max_redirections</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Maximum retry attempts for redirection.</td>
</tr>
<tr>
<td><code>max_connection_attempts</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Maximum retry attempts for connection.</td>
</tr>
<tr>
<td><code>max_connection_timeout</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Maximum connection timeout in total among the retries.</td>
</tr>
</tbody>
</table>
<p>The <code>nodes</code> is an array of Cluster node records:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ip</code></td>
<td style="text-align: center;"><code>"127.0.0.1"</code></td>
<td>The IP address to connect.</td>
</tr>
<tr>
<td><code>port</code></td>
<td style="text-align: center;"><code>6379</code></td>
<td>The port to connect.</td>
</tr>
</tbody>
</table>
<p>The <code>cluster</code> implementation is selected when you pass <code>nodes</code> as part of <code>redis</code>
configuration.</p>
<p>For <code>cluster</code> to work properly, you need to configure <code>lock_zone</code>, so also add this
to your Nginx configuration:</p>
<div class="highlight"><pre><span></span><code><span class="k">lua_shared_dict</span><span class="w"> </span><span class="s">redis_cluster_locks</span><span class="w"> </span><span class="mi">100k</span><span class="p">;</span>
</code></pre></div>
<p>And set the <code>lock_zone</code> to <code>"redis_cluster_locks"</code></p>
<p>The implementation requires <code>resty-redis-cluster</code> or <code>kong-redis-cluster</code> which you can install with LuaRocks:
<div class="highlight"><pre><span></span><code><span class="w"> </span>luarocks<span class="w"> </span>install<span class="w"> </span>resty-redis-cluster
<span class="c1">## or</span>
<span class="w"> </span>luarocks<span class="w"> </span>install<span class="w"> </span>kong-redis-cluster
</code></pre></div></p>
<h2 id="shm-configuration">SHM Configuration</h2>
<p>With SHM storage you can use the following settings (set the <code>storage</code> to <code>"shm"</code>):</p>
<table>
<thead>
<tr>
<th>Option</th>
<th style="text-align: center;">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prefix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Prefix for the keys stored in SHM.</td>
</tr>
<tr>
<td><code>suffix</code></td>
<td style="text-align: center;"><code>nil</code></td>
<td>Suffix for the keys stored in SHM.</td>
</tr>
<tr>
<td><code>zone</code></td>
<td style="text-align: center;"><code>"sessions"</code></td>
<td>A name of shared memory zone.</td>
</tr>
</tbody>
</table>
<p>You will also need to create a shared dictionary <code>zone</code> in Nginx:</p>
<div class="highlight"><pre><span></span><code><span class="k">lua_shared_dict</span><span class="w"> </span><span class="s">sessions</span><span class="w"> </span><span class="mi">10m</span><span class="p">;</span>
</code></pre></div>
<p><em>Note:</em> you may need to adjust the size of shared memory zone according to your needs.</p>
<h2 id="api">API</h2>
<p>LDoc generated API docs can also be viewed at <a href="https://bungle.github.io/lua-resty-session/">bungle.github.io/lua-resty-session</a>.</p>
<h2 id="initialization">Initialization</h2>
<h3 id="sessioninit">session.init</h3>
<p><strong>syntax:</strong> <em>session.init(configuration)</em></p>
<p>Initialize the session library.</p>
<p>This function can be called on <code>init</code> or <code>init_worker</code> phases on OpenResty
to set global default configuration to all session instances created by this
library.</p>
<div class="highlight"><pre><span></span><code><span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">init</span><span class="p">({</span>
  <span class="n">audience</span> <span class="o">=</span> <span class="s2">&quot;my-application&quot;</span><span class="p">,</span>
  <span class="n">storage</span> <span class="o">=</span> <span class="s2">&quot;redis&quot;</span><span class="p">,</span>
  <span class="n">redis</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;session&quot;</span><span class="p">,</span>
    <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;storage&quot;</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">})</span>
</code></pre></div>
<p>See <a href="#configuration">configuration</a> for possible configuration settings.</p>
<h2 id="constructors">Constructors</h2>
<h3 id="sessionnew">session.new</h3>
<p><strong>syntax:</strong> <em>session = session.new(configuration)</em></p>
<p>Creates a new session instance.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="c1">-- OR</span>
<span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">({</span>
  <span class="n">audience</span> <span class="o">=</span> <span class="s2">&quot;my-application&quot;</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<p>See <a href="#configuration">configuration</a> for possible configuration settings.</p>
<h2 id="helpers">Helpers</h2>
<h3 id="sessionopen">session.open</h3>
<p><strong>syntax:</strong> <em>session, err, exists = session.open(configuration)</em></p>
<p>This can be used to open a session, and it will either return an existing
session or a new session. The <code>exists</code> (a boolean) return parameters tells whether
it was existing or new session that was returned. The <code>err</code> (a string) contains
a message of why opening might have failed (the function will still return
<code>session</code> too).</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="c1">-- OR</span>
<span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">({</span>
  <span class="n">audience</span> <span class="o">=</span> <span class="s2">&quot;my-application&quot;</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<p>See <a href="#configuration">configuration</a> for possible configuration settings.</p>
<h3 id="sessionstart">session.start</h3>
<p><strong>syntax:</strong> <em>session, err, exists, refreshed = session.start(configuration)</em></p>
<p>This can be used to start a session, and it will either return an existing
session or a new session. In case there is an existing session, the
session will be refreshed as well (as needed). The <code>exists</code> (a boolean)
return parameters tells whether it was existing or new session that was
returned. The <code>refreshed</code> (a boolean) tells whether the call to <code>refresh</code>
was succesful.  The <code>err</code> (a string) contains a message of why opening or
refreshing might have failed (the function will still return <code>session</code> too).</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
<span class="c1">-- OR</span>
<span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span><span class="p">,</span> <span class="n">refreshed</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">start</span><span class="p">({</span>
  <span class="n">audience</span> <span class="o">=</span> <span class="s2">&quot;my-application&quot;</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<p>See <a href="#configuration">configuration</a> for possible configuration settings.</p>
<h3 id="sessionlogout">session.logout</h3>
<p><strong>syntax:</strong> <em>ok, err, exists, logged_out = session.logout(configuration)</em></p>
<p>It logouts from a specific audience.</p>
<p>A single session cookie may be shared between multiple audiences
(or applications), thus there is a need to be able to logout from
just a single audience while keeping the session for the other
audiences. The <code>exists</code> (a boolean) return parameters tells whether
session existed. The <code>logged_out</code> (a boolean) return parameter signals
if the session existed and was also logged out. The <code>err</code> (a string)
contains a reason why session didn't exists or why the logout failed.
The <code>ok</code> (truthy) will be <code>true</code> when session existed and was
successfully logged out.</p>
<p>When there is only a single audience, then this can be considered
equal to <code>session.destroy</code>.</p>
<p>When the last audience is logged out, the cookie will be destroyed
as well and invalidated on a client.</p>
<div class="highlight"><pre><span></span><code><span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">logout</span><span class="p">()</span>
<span class="c1">-- OR</span>
<span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span><span class="p">,</span> <span class="n">logged_out</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">logout</span><span class="p">({</span>
  <span class="n">audience</span> <span class="o">=</span> <span class="s2">&quot;my-application&quot;</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<p>See <a href="#configuration">configuration</a> for possible configuration settings.</p>
<h3 id="sessiondestroy">session.destroy</h3>
<p><strong>syntax:</strong> <em>ok, err, exists, destroyed = session.destroy(configuration)</em></p>
<p>It destroys the whole session and clears the cookies.</p>
<p>A single session cookie may be shared between multiple audiences
(or applications), thus there is a need to be able to logout from
just a single audience while keeping the session for the other
audiences. The <code>exists</code> (a boolean) return parameters tells whether
session existed. The <code>destroyed</code> (a boolean) return parameter signals
if the session existed and was also destroyed out. The <code>err</code> (a string)
contains a reason why session didn't exists or why the logout failed.
The <code>ok</code> (truthy) will be <code>true</code> when session existed and was
successfully logged out.</p>
<div class="highlight"><pre><span></span><code><span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">destroy</span><span class="p">()</span>
<span class="c1">-- OR</span>
<span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span><span class="p">,</span> <span class="n">destroyed</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">destroy</span><span class="p">({</span>
  <span class="n">cookie_name</span> <span class="o">=</span> <span class="s2">&quot;auth&quot;</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<p>See <a href="#configuration">configuration</a> for possible configuration settings.</p>
<h2 id="instance-methods">Instance Methods</h2>
<h3 id="sessionopen_1">session:open</h3>
<p><strong>syntax:</strong> <em>ok, err = session:open()</em></p>
<p>This can be used to open a session. It returns <code>true</code> when
session was opened and validated. Otherwise, it returns <code>nil</code> and
an error message.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">ok</span> <span class="kr">then</span>
  <span class="c1">-- session exists</span>

<span class="kr">else</span>
  <span class="c1">-- session did not exists or was invalid</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionsave">session:save</h3>
<p><strong>syntax:</strong> <em>ok, err = session:save()</em></p>
<p>Saves the session data and issues a new session cookie with a new session id.
When <code>remember</code> is enabled, it will also issue a new persistent cookie and
possibly save the data in backend store. It returns <code>true</code> when session was saved.
Otherwise, it returns <code>nil</code> and an error message.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">session</span><span class="p">:</span><span class="n">set_subject</span><span class="p">(</span><span class="s2">&quot;john&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">ok</span> <span class="kr">then</span>
  <span class="c1">-- error when saving session</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessiontouch">session:touch</h3>
<p><strong>syntax:</strong> <em>ok, err = session:touch()</em></p>
<p>Updates idling offset of the session by sending an updated session cookie.
It only sends the client cookie and never calls any backend session store
APIs. Normally the <code>session:refresh</code> is used to call this indirectly. In
error case it returns <code>nil</code> and an error message, otherwise <code>true</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">touch</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionrefresh">session:refresh</h3>
<p><strong>syntax:</strong> <em>ok, err = session:refresh()</em></p>
<p>Either saves the session (creating a new session id) or touches the session
depending on whether the rolling timeout is getting closer, which means
by default when 3/4 of rolling timeout is spent, that is 45 minutes with default
rolling timeout of an hour. The touch has a threshold, by default one minute,
so it may be skipped in some cases (you can call <code>session:touch()</code> to force it).
In error case it returns <code>nil</code> and an error message, otherwise <code>true</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">refresh</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<p>The above code looks a bit like <code>session.start()</code> helper.</p>
<h3 id="sessionlogout_1">session:logout</h3>
<p><strong>syntax:</strong> <em>ok, err = session:logout()</em></p>
<p>Logout either destroys the session or just clears the data for the current audience,
and saves it (logging out from the current audience). In error case it returns <code>nil</code>
and an error message, otherwise <code>true</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">logout</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessiondestroy_1">session:destroy</h3>
<p><strong>syntax:</strong> <em>ok, err = session:destroy()</em></p>
<p>Destroy the session and clear the cookies. In error case it returns <code>nil</code>
and an error message, otherwise <code>true</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">destroy</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionclose">session:close</h3>
<p><strong>syntax:</strong> <em>session:close()</em></p>
<p>Just closes the session instance so that it cannot be used anymore.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">session</span><span class="p">:</span><span class="n">set_subject</span><span class="p">(</span><span class="s2">&quot;john&quot;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">ok</span> <span class="kr">then</span>
  <span class="c1">-- error when saving session</span>
<span class="kr">end</span>
<span class="n">session</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<h3 id="sessionset_data">session:set_data</h3>
<p><strong>syntax:</strong> <em>session:set_data(data)</em></p>
<p>Set session data. The <code>data</code> needs to be a <code>table</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">exists</span> <span class="kr">then</span>
   <span class="n">session</span><span class="p">:</span><span class="n">set_data</span><span class="p">({</span>
     <span class="n">cart</span> <span class="o">=</span> <span class="p">{},</span>
   <span class="p">})</span>
  <span class="n">session</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionget_data">session:get_data</h3>
<p><strong>syntax:</strong> <em>data = session:get_data()</em></p>
<p>Get session data.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">get_data</span><span class="p">()</span>
  <span class="n">ngx</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">set_header</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">..</span> <span class="n">data</span><span class="p">.</span><span class="n">access_token</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionset">session:set</h3>
<p><strong>syntax:</strong> <em>session:set(key, value)</em></p>
<p>Set a value in session.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="n">session</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;access-token&quot;</span><span class="p">,</span> <span class="s2">&quot;eyJ...&quot;</span><span class="p">)</span>
  <span class="n">session</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionget">session:get</h3>
<p><strong>syntax:</strong> <em>value = session:get(key)</em></p>
<p>Get a value from session.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">access_token</span> <span class="o">=</span> <span class="n">session</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access-token&quot;</span><span class="p">)</span>
  <span class="n">ngx</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">set_header</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;Bearer &quot;</span> <span class="o">..</span> <span class="n">access_token</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionset_audience">session:set_audience</h3>
<p><strong>syntax:</strong> <em>session:set_audience(audience)</em></p>
<p>Set session audience.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">session</span><span class="p">.</span><span class="n">set_audience</span><span class="p">(</span><span class="s2">&quot;my-service&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="sessionget_audience">session:get_audience</h3>
<p><strong>syntax:</strong> <em>audience = session:get_audience()</em></p>
<p>Set session subject.</p>
<h3 id="sessionset_subject">session:set_subject</h3>
<p><strong>syntax:</strong> <em>session:set_subject(subject)</em></p>
<p>Set session audience.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">session</span><span class="p">.</span><span class="n">set_subject</span><span class="p">(</span><span class="s2">&quot;john@doe.com&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="sessionget_subject">session:get_subject</h3>
<p><strong>syntax:</strong> <em>subject = session:get_subject()</em></p>
<p>Get session subject.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">get_subject</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionget_property">session:get_property</h3>
<p><strong>syntax:</strong> <em>value = session:get_property(name)</em></p>
<p>Get session property. Possible property names:</p>
<ul>
<li><code>"id"</code>: 43 bytes session id (same as nonce, but base64 url-encoded)</li>
<li><code>"nonce"</code>: 32 bytes nonce (same as session id but in raw bytes)</li>
<li><code>"audience"</code>: Current session audience</li>
<li><code>"subject"</code>: Current session subject</li>
<li><code>"timeout"</code>: Closest timeout (in seconds) (what's left of it)</li>
<li><code>"idling-timeout</code>"`: Session idling timeout (in seconds) (what's left of it)</li>
<li><code>"rolling-timeout</code>"`: Session rolling timeout (in seconds) (what's left of it)</li>
<li><code>"absolute-timeout</code>"`: Session absolute timeout (in seconds) (what's left of it)</li>
</ul>
<p><em>Note:</em> the returned value may be <code>nil</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionset_remember">session:set_remember</h3>
<p><strong>syntax:</strong> <em>session:set_remember(value)</em></p>
<p>Set persistent sessions on/off.</p>
<p>In many login forms user is given an option for "remember me".
You can call this function based on what user selected.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">ngx</span><span class="p">.</span><span class="n">var</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">remember</span> <span class="kr">then</span>
  <span class="n">session</span><span class="p">:</span><span class="n">set_remember</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="kr">end</span>
<span class="n">session</span><span class="p">:</span><span class="n">set_subject</span><span class="p">(</span><span class="n">ngx</span><span class="p">.</span><span class="n">var</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">username</span><span class="p">)</span>
<span class="n">session</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<h3 id="sessionget_remember">session:get_remember</h3>
<p><strong>syntax:</strong> <em>remember = session:get_remember()</em></p>
<p>Get state of persistent sessions.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">remember</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">get_remember</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionclear_request_cookie">session:clear_request_cookie</h3>
<p><strong>syntax:</strong> <em>session:clear_request_cookie()</em></p>
<p>Modifies the request headers by removing the session related
cookies. This is useful when you use the session library on
a proxy server and don't want the session cookies to be forwarded
to the upstream service.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="n">session</span><span class="p">:</span><span class="n">clear_request_cookie</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessionset_headers">session:set_headers</h3>
<p><strong>syntax:</strong> <em>session:set_headers(arg1, arg2, ...)</em></p>
<p>Sets request and response headers based on configuration.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">({</span>
  <span class="n">request_headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;audience&quot;</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">},</span>
  <span class="n">response_headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;idling-timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;rolling-timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;absolute-timeout&quot;</span> <span class="p">},</span>
<span class="p">})</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="n">session</span><span class="p">:</span><span class="n">set_headers</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<p>When called without arguments it will set request headers configured with <code>request_headers</code>
and response headers configured with <code>response_headers</code>.</p>
<p>See <a href="#configuration">configuration</a> for possible header names.</p>
<h3 id="sessionset_request_headers">session:set_request_headers</h3>
<p><strong>syntax:</strong> <em>session:set_request_headers(arg1, arg2, ...)</em></p>
<p>Set request headers.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="n">session</span><span class="p">:</span><span class="n">set_request_headers</span><span class="p">(</span><span class="s2">&quot;audience&quot;</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>When called without arguments it will set request headers configured with <code>request_headers</code>.</p>
<p>See <a href="#configuration">configuration</a> for possible header names.</p>
<h3 id="sessionset_response_headers">session:set_response_headers</h3>
<p><strong>syntax:</strong> <em>session:set_response_headers(arg1, arg2, ...)</em></p>
<p>Set request headers.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="n">session</span><span class="p">:</span><span class="n">set_response_headers</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;idling-timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;rolling-timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;absolute-timeout&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>When called without arguments it will set request headers configured with <code>response_headers</code>.</p>
<p>See <a href="#configuration">configuration</a> for possible header names.</p>
<h3 id="sessioninfoset">session.info:set</h3>
<p><strong>syntax:</strong> <em>session.info:set(key, value)</em></p>
<p>Set a value in session information store. Session information store
may be used in scenarios when you want to store data on server side
storage, but do not want to create a new session and send a new
session cookie. The information store data is not considered when
checking authentication tag or message authentication code. Thus if
you want to use this for data that needs to be encrypted, you need
to encrypt value before passing it to thus function.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="n">session</span><span class="p">.</span><span class="n">info</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;last-access&quot;</span><span class="p">,</span> <span class="n">ngx</span><span class="p">.</span><span class="n">now</span><span class="p">())</span>
  <span class="n">session</span><span class="p">.</span><span class="n">info</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
<p>With cookie storage this still works, but it is then almost the same as
<code>session:set</code>.</p>
<h3 id="sessioninfoget">session.info:get</h3>
<p><strong>syntax:</strong> <em>value = session.info:get(key)</em></p>
<p>Get a value from session information store.</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">open</span><span class="p">()</span>
<span class="kr">if</span> <span class="n">exists</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">last_access</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">info</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last-access&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<h3 id="sessioninfosave">session.info:save</h3>
<p><strong>syntax:</strong> <em>value = session.info:save()</em></p>
<p>Save information. Only updates backend storage. Does not send a new cookie (except with cookie storage).</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;resty.session&quot;</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">session</span><span class="p">.</span><span class="n">info</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;last-access&quot;</span><span class="p">,</span> <span class="n">ngx</span><span class="p">.</span><span class="n">now</span><span class="p">())</span>
<span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">info</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<h2 id="cookie-format">Cookie Format</h2>
<div class="highlight"><pre><span></span><code>[ HEADER -------------------------------------------------------------------------------------]
[ Type || Flags || SID || Created at || Rolling Offset || Size || Tag || Idling Offset || Mac ]
[ 1B   || 2B    || 32B || 5B         || 4B             || 3B   || 16B || 3B            || 16B ]
</code></pre></div>
<p>and</p>
<div class="highlight"><pre><span></span><code>[ PAYLOAD --]
[ Data  *B  ]   
</code></pre></div>
<p>Both the <code>HEADER</code> and <code>PAYLOAD</code> are base64 url-encoded before putting in a <code>Set-Cookie</code> header.
When using a server side storage, the <code>PAYLOAD</code> is not put in the cookie. With cookie storage
the base64 url-encoded header is concatenated with base64 url-encoded payload.</p>
<p>The <code>HEADER</code> is fixed size 82 bytes binary or 110 bytes in base64 url-encoded form.</p>
<p>Header fields explained:</p>
<ul>
<li>Type: number <code>1</code> binary packed in a single little endian byte (currently the only supported <code>type</code>).</li>
<li>Flags: binary packed flags (short) in a two byte little endian form.</li>
<li>SID: <code>32</code> bytes of crypto random data (Session ID).</li>
<li>Created at: binary packed secs from epoch in a little endian form, truncated to 5 bytes.</li>
<li>Rolling Offset: binary packed secs from creation time in a little endian form (integer). </li>
<li>Size: binary packed data size (short) in a two byte little endian form.</li>
<li>Tag: <code>16</code> bytes of authentication tag from AES-256-GCM encryption of the data.</li>
<li>Idling Offset: binary packed secs from creation time + rolling offset in a little endian form, truncated to 3 bytes.</li>
<li>Mac: <code>16</code> bytes message authentication code of the header.</li>
</ul>
<h2 id="data-encryption">Data Encryption</h2>
<ol>
<li>Initial keying material (IKM):</li>
<li>derive IKM from <code>secret</code> by hashing <code>secret</code> with SHA-256, or</li>
<li>use 32 byte IKM when passed to library with <code>ikm</code></li>
<li>Generate 32 bytes of crypto random session id (<code>sid</code>) </li>
<li>Derive 32 byte encryption key and 12 byte initialization vector with HKDF using SHA-256 (on FIPS-mode it uses PBKDF2 with SHA-256 instead)</li>
<li>Use HKDF extract to derive a new key from <code>ikm</code> to get <code>key</code> (this step can be done just once per <code>ikm</code>):<ul>
<li>output length: <code>32</code></li>
<li>digest: <code>"sha256"</code></li>
<li>key: <code>&lt;ikm&gt;</code></li>
<li>mode: <code>extract only</code></li>
<li>info: <code>""</code></li>
<li>salt: <code>""</code></li>
</ul>
</li>
<li>Use HKDF expand to derive <code>44</code> bytes of <code>output</code>:<ul>
<li>output length: <code>44</code></li>
<li>digest: <code>"sha256"</code></li>
<li>key: <code>&lt;key&gt;</code></li>
<li>mode: <code>expand only</code></li>
<li>info: <code>"encryption:&lt;sid&gt;"</code></li>
<li>salt: <code>""</code></li>
</ul>
</li>
<li>The first 32 bytes of <code>output</code> are the encryption key (<code>aes-key</code>), and the last 12 bytes are the initialization vector (<code>iv</code>)</li>
<li>Encrypt <code>plaintext</code> (JSON encoded and optionally deflated) using AES-256-GCM to get <code>ciphertext</code> and <code>tag</code></li>
<li>cipher: <code>"aes-256-gcm"</code></li>
<li>key: <code>&lt;aes-key&gt;</code></li>
<li>iv: <code>&lt;iv&gt;</code></li>
<li>plaintext: <code>&lt;plaintext&gt;</code></li>
<li>aad: use the first 47 bytes of <code>header</code> as <code>aad</code>, that includes:<ol>
<li>Type</li>
<li>Flags</li>
<li>Session ID</li>
<li>Creation Time</li>
<li>Rolling Offset</li>
<li>Data Size</li>
</ol>
</li>
</ol>
<p>There is a variation for <code>remember</code> cookies on step 3, where we may use <code>PBKDF2</code>
instead of <code>HKDF</code>, depending  on <code>remember_safety</code> setting (we also use it in FIPS-mode).
The <code>PBKDF2</code> settings:</p>
<ul>
<li>output length: <code>44</code></li>
<li>digest: <code>"sha256"</code></li>
<li>password: <code>&lt;key&gt;</code></li>
<li>salt: <code>"encryption:&lt;sid&gt;"</code></li>
<li>iterations: <code>&lt;1000|10000|100000|1000000&gt;</code></li>
</ul>
<p>Iteration counts are based on <code>remember_safety</code> setting (<code>"Low"</code>, <code>"Medium"</code>, <code>"High"</code>, <code>"Very High"</code>),
if <code>remember_safety</code> is set to <code>"None"</code>, we will use the HDKF as above.</p>
<h2 id="cookie-header-authentication">Cookie Header Authentication</h2>
<ol>
<li>Derive 32 byte authentication key (<code>mac_key</code>) with HKDF using SHA-256  (on FIPS-mode it uses PBKDF2 with SHA-256 instead):<ol>
<li>Use HKDF extract to derive a new key from <code>ikm</code> to get <code>key</code> (this step can be done just once per <code>ikm</code> and reused with encryption key generation):<ul>
<li>output length: <code>32</code></li>
<li>digest: <code>"sha256"</code></li>
<li>key: <code>&lt;ikm&gt;</code></li>
<li>mode: <code>extract only</code></li>
<li>info: <code>""</code></li>
<li>salt: <code>""</code></li>
</ul>
</li>
<li>Use HKDF expand to derive <code>32</code> bytes of <code>mac-key</code>:<ul>
<li>output length: <code>32</code></li>
<li>digest: <code>"sha256"</code></li>
<li>key: <code>&lt;key&gt;</code></li>
<li>mode: <code>expand only</code></li>
<li>info: <code>"authentication:&lt;sid&gt;"</code></li>
<li>salt: <code>""</code></li>
</ul>
</li>
</ol>
</li>
<li>Calculate message authentication code using HMAC-SHA256:</li>
<li>digest: <code>"sha256"</code></li>
<li>key: <code>&lt;mac-key&gt;</code></li>
<li>message: use the first 66 bytes of <code>header</code>, that includes:<ol>
<li>Type</li>
<li>Flags</li>
<li>Session ID</li>
<li>Creation Time</li>
<li>Rolling Offset</li>
<li>Data Size</li>
<li>Tag</li>
<li>Idling Offset</li>
</ol>
</li>
</ol>
<h2 id="custom-storage-interface">Custom Storage Interface</h2>
<p>If you want to implement custom storage, you need to implement following interface:</p>
<div class="highlight"><pre><span></span><code><span class="c1">---</span>
<span class="c1">-- &lt;custom&gt; backend for session library</span>
<span class="c1">--</span>
<span class="c1">-- @module &lt;custom&gt;</span>


<span class="c1">---</span>
<span class="c1">-- Storage</span>
<span class="c1">-- @section instance</span>


<span class="kd">local</span> <span class="n">metatable</span> <span class="o">=</span> <span class="p">{}</span>


<span class="n">metatable</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">metatable</span>


<span class="kr">function</span> <span class="nc">metatable</span><span class="p">.</span><span class="nf">__newindex</span><span class="p">()</span>
  <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;attempt to update a read-only table&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="kr">end</span>


<span class="c1">---</span>
<span class="c1">-- Store session data.</span>
<span class="c1">--</span>
<span class="c1">-- @function instance:set</span>
<span class="c1">-- @tparam string name cookie name</span>
<span class="c1">-- @tparam string key session key</span>
<span class="c1">-- @tparam string value session value</span>
<span class="c1">-- @tparam number ttl session ttl</span>
<span class="c1">-- @tparam number current_time current time</span>
<span class="c1">-- @tparam[opt] string old_key old session id</span>
<span class="c1">-- @tparam string stale_ttl stale ttl</span>
<span class="c1">-- @tparam[opt] table metadata table of metadata</span>
<span class="c1">-- @tparam boolean remember whether storing persistent session or not</span>
<span class="c1">-- @treturn true|nil ok</span>
<span class="c1">-- @treturn string error message</span>
<span class="kr">function</span> <span class="nc">metatable</span><span class="p">:</span><span class="nf">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ttl</span><span class="p">,</span> <span class="n">current_time</span><span class="p">,</span> <span class="n">old_key</span><span class="p">,</span> <span class="n">stale_ttl</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">remember</span><span class="p">)</span>
  <span class="c1">-- NYI</span>
<span class="kr">end</span>


<span class="c1">---</span>
<span class="c1">-- Retrieve session data.</span>
<span class="c1">--</span>
<span class="c1">-- @function instance:get</span>
<span class="c1">-- @tparam string name cookie name</span>
<span class="c1">-- @tparam string key session key</span>
<span class="c1">-- @treturn string|nil session data</span>
<span class="c1">-- @treturn string error message</span>
<span class="kr">function</span> <span class="nc">metatable</span><span class="p">:</span><span class="nf">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
  <span class="c1">-- NYI</span>
<span class="kr">end</span>


<span class="c1">---</span>
<span class="c1">-- Delete session data.</span>
<span class="c1">--</span>
<span class="c1">-- @function instance:delete</span>
<span class="c1">-- @tparam string name cookie name</span>
<span class="c1">-- @tparam string key session key</span>
<span class="c1">-- @tparam[opt] table metadata  session meta data</span>
<span class="c1">-- @treturn boolean|nil session data</span>
<span class="c1">-- @treturn string error message</span>
<span class="kr">function</span> <span class="nc">metatable</span><span class="p">:</span><span class="nf">delete</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">current_time</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
  <span class="c1">-- NYI</span>
<span class="kr">end</span>


<span class="kd">local</span> <span class="n">storage</span> <span class="o">=</span> <span class="p">{}</span>


<span class="c1">---</span>
<span class="c1">-- Constructors</span>
<span class="c1">-- @section constructors</span>


<span class="c1">---</span>
<span class="c1">-- Configuration</span>
<span class="c1">-- @section configuration</span>


<span class="c1">---</span>
<span class="c1">-- &lt;custom&gt; storage backend configuration</span>
<span class="c1">-- @field &lt;field-name&gt; TBD</span>
<span class="c1">-- @table configuration</span>


<span class="c1">---</span>
<span class="c1">-- Create a &lt;custom&gt; storage.</span>
<span class="c1">--</span>
<span class="c1">-- This creates a new shared memory storage instance.</span>
<span class="c1">--</span>
<span class="c1">-- @function module.new</span>
<span class="c1">-- @tparam[opt]  table   configuration  &lt;custom&gt; storage @{configuration}</span>
<span class="c1">-- @treturn      table                  &lt;custom&gt; storage instance</span>
<span class="kr">function</span> <span class="nc">storage</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
  <span class="c1">-- NYI</span>
  <span class="c1">-- return setmetatable({}, metatable)</span>
<span class="kr">end</span>


<span class="kr">return</span> <span class="n">storage</span>
</code></pre></div>
<p>Please check the existing implementations for the defails. And please
make a pull-request so that we can integrate it directly to library
for other users as well.</p>
<h2 id="github">GitHub</h2>
<p>You may find additional configuration tips and documentation for this module in the <a href="https://github.com/bungle/lua-resty-session" target="_blank">GitHub repository for 
nginx-module-session</a>.</p>







  
  



  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2014 - 2023 GetPageSpeed LLC 2023
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/GetPageSpeed" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/GetPageSpeed" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/getpagespeed" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/getpagespeed/" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://t.me/GetPageSpeed" target="_blank" rel="noopener" title="t.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.top", "navigation.tabs", "search.suggest", "content.tooltips", "content.tabs.link", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>